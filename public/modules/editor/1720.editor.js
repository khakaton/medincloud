(self.webpackChunk=self.webpackChunk||[]).push([[1720],{80955:function(t,e,s){"use strict";s.r(e),s.d(e,{default:function(){return f}});var r=s(6610),n=s(5991),a=s(92137),i=s(87757),o=s.n(i),u=s(38773),c=s(15272),l=s(32543),h=function(){function t(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};(0,r.Z)(this,t),this.formId=e,this.fields=[],this.submitButtons=[],this.method=n,this.options=a,this.modelName=s;var i="/ajax/models/".concat(s),o=this.options,c=o.dynamicURL,l=o.customRoute;switch(s){case"login":i="/login";break;case"logout":i="/logout";break;case"email":i="/ajax/feedback"}l&&(i=l),this.resource=new u.default({route:i,dynamicURL:c})}var e;return(0,n.Z)(t,[{key:"setFields",value:function(t){this.fields=t}},{key:"addSubmitButton",value:function(t){this.submitButtons.push(t)}},{key:"addField",value:function(t){var e=!1;return this.fields=this.fields.map((function(s){return s.getId()===t.getId()?(e=!0,t.component?t:s):s})),e||this.fields.push(t),!0}},{key:"submit",value:(e=(0,a.Z)(o().mark((function t(){var e,r,n,a,i,u,c,h,d,f=this,g=arguments;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=g.length>0&&void 0!==g[0]?g[0]:null,r=g.length>1&&void 0!==g[1]?g[1]:"",n=g.length>2&&void 0!==g[2]?g[2]:null,a=g.length>3&&void 0!==g[3]?g[3]:null,i=!0,!r){t.next=11;break}return t.next=8,confirm(r);case 8:if(t.sent){t.next=11;break}return t.abrupt("return",{success:!1});case 11:if(this.fields.forEach((function(t){t.fieldValidate()||(i=!1)})),!i){t.next=71;break}t.prev=13,t.t0=this.method,t.next="POST"===t.t0?17:"PUT"===t.t0?32:"GET"===t.t0?43:"DELETE"===t.t0?48:54;break;case 17:return t.next=19,this.resource.post(_.assign(this.getData(),n),a);case 19:if(u=t.sent,"login"!==this.modelName||!this.options.afterLoginRedirect){t.next=23;break}return document.location.replace(this.options.afterLoginRedirect),t.abrupt("return",u);case 23:if("logout"!==this.modelName||!this.options.afterLogoutRedirect){t.next=26;break}return document.location.replace(this.options.afterLogoutRedirect),t.abrupt("return",u);case 26:if(!u.reload){t.next=29;break}return document.location.reload(),t.abrupt("return");case 29:return this.clearInputs(),this.updateResponseStorage(u),t.abrupt("return",u);case 32:if(!e&&!this.options.customRoute){t.next=41;break}return console.log(_.assign(this.getData(),n)),t.next=36,this.resource.put(e,_.assign(this.getData(),n),a);case 36:return c=t.sent,console.log(c),Promise.resolve().then(s.bind(s,75098)).then((function(t){t.default.updateModelWithData(f.modelName,e,f.getData())})),this.updateResponseStorage(c),t.abrupt("return",c);case 41:return console.error("Не удалось получить ИД модели для обновления или customRoute!"),t.abrupt("break",54);case 43:return t.next=45,this.resource.getQueried(_.assign(this.getData(),n),a);case 45:return h=t.sent,this.updateResponseStorage(h),t.abrupt("return",h);case 48:if(!e&&!this.options.customRoute){t.next=52;break}return t.next=51,this.resource.delete(e,_.assign(this.getData(),n),a);case 51:return t.abrupt("return",t.sent);case 52:return console.error("Не удалось получить ИД модели для удаления или customRoute!"),t.abrupt("break",54);case 54:t.next=69;break;case 56:if(t.prev=56,t.t1=t.catch(13),d=t.t1.status,t.t1.res instanceof Promise&&(t.t1=t.t1.res),!(t.t1 instanceof Promise)){t.next=68;break}return t.next=63,t.t1.then();case 63:t.t1=t.sent,t.t1=(0,l.mbParseJSON)(t.t1,t.t1),t.t1.data&&(t.t1=t.t1.data),d&&(t.t1.data?t.t1.data.__status=d:t.t1.__status=d),this.updateResponseStorage(t.t1);case 68:return t.abrupt("return",{success:!1,error:t.t1});case 69:t.next=74;break;case 71:return t.next=73,alert("Пожалуйста, заполните все обязательные поля");case 73:return t.abrupt("return",{success:!1});case 74:case"end":return t.stop()}}),t,this,[[13,56]])}))),function(){return e.apply(this,arguments)})},{key:"clearInputs",value:function(){this.fields.forEach((function(t){try{_.isFunction(_.get(t,"component.setState"))}catch(t){console.error(t)}}))}},{key:"getData",value:function(){var t={altrp_ajax:!0};if("email"===this.modelName){var e="",s="Altrp Email";this.submitButtons.forEach((function(t){t.getSettings("email_subject")&&(s=t.getSettings("email_subject"))})),this.fields.forEach((function(t){if(null!==t.getValue()){var s=t.getSettings("content_label")||t.getSettings("content_placeholder")||"",r=t.getValue();e+="".concat(s,": ").concat(r," <br/> ")}})),t.subject=s,t.user_message=e}else this.fields.forEach((function(e){t[e.getFieldId()]=e.getValue()}));return t}},{key:"updateResponseStorage",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};appStore.dispatch((0,c.Nb)(this.formId,t))}}]),t}(),d=function(){function t(){(0,r.Z)(this,t),this.forms=[],this.formIds=[],this.fieldsStorage={}}return(0,n.Z)(t,[{key:"registerForm",value:function(t,e,s){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=this.getForm(t);return n?_.isEmpty(r)||(n.options=r):(n=new h(t,e,s,r),this.fieldsStorage[t]&&this.fieldsStorage[t].length&&(n.setFields(this.fieldsStorage[t]),delete this.fieldsStorage[t]),this.forms.push(n)),n}},{key:"deleteFormById",value:function(t){this.forms=this.forms.filter((function(e){return e.formId!==t}))}},{key:"addField",value:function(t,e){var s=this.getForm(t);return s?s.addField(e):(this.fieldsStorage[t]=this.fieldsStorage[t]||[],this.fieldsStorage[t].push(e),!0)}},{key:"clearFieldsStorage",value:function(){this.fieldsStorage={}}},{key:"submitForm",value:function(t,e){return this.getForm(t)?this.getForm(t).submit(e):(console.error("Форма не найдена"),!1)}},{key:"getForm",value:function(t){var e=null;return this.forms.forEach((function(s){s.formId===t&&(e=s)})),e}},{key:"clearFormsStore",value:function(){this.forms=[]}}]),t}();window.formsManager=new d;var f=window.formsManager}}]);
//# sourceMappingURL=1720.editor.js.map