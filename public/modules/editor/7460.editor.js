(self.webpackChunk=self.webpackChunk||[]).push([[7460],{23525:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return We}});var n=r(85061),a=r(96156),o=r(92137),c=r(28481),l=r(87757),i=r.n(l),u=r(67294),s=r(77579),p=r(42564),d=r(9198),m=r.n(d),f=r(30734),v=r(9669),g=r.n(v),b=r(28523),h=r(13981),y=r(548),O=r(80864),E=r(35005),w=r(64367),Z=r(65056),j=r(5367),k=r(23233),P=r(58965),D=r(10895),C=r(22683),S=_.find(k.Z,{value:"regagro"}).colors,x=_.find(k.Z,{value:"milk"}).colors,N=_.find(k.Z,{value:"milk2"}).colors,T=function(e){var t=e.widget,r=(e.width,e.height),n=void 0===r?450:r,l=e.dataSource,s=void 0===l?[]:l,p=e.groupMode,d=void 0===p?"stacked":p,m=e.layout,f=void 0===m?"vertical":m,v=e.colorScheme,g=void 0===v?"regagro":v,b=e.reverse,h=void 0!==b&&b,y=e.enableLabel,O=void 0!==y&&y,E=e.padding,w=void 0===E?.1:E,k=e.innerPadding,T=void 0===k?0:k,q=e.borderRadius,W=void 0===q?0:q,I=e.borderWidth,M=void 0===I?0:I,F=e.sort,G=void 0===F?"":F,R=e.tickRotation,B=void 0===R?0:R,L=e.bottomAxis,J=void 0===L||L,Y=e.enableGridX,A=void 0===Y||Y,V=e.enableGridY,z=void 0===V||V,H=e.customColorSchemeChecker,X=void 0!==H&&H,K=e.customColors,$=void 0===K?[]:K,Q=(e.yScaleMax,e.widgetID),U=e.useCustomTooltips,ee=(0,u.useState)(!1),te=(0,c.Z)(ee,2),re=te[0],ne=te[1],ae=(0,u.useState)([]),oe=(0,c.Z)(ae,2),ce=oe[0],le=oe[1],ie=(0,u.useCallback)((0,o.Z)(i().mark((function e(){var r,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ne(!0),0!=s.length){e.next=8;break}return e.next=4,(0,D.O)(t.source,t.filter);case 4:200===(r=e.sent).status&&(n=r.data.data.map((function(e,t){var r;return r={},(0,a.Z)(r,e.key,Number(e.data)),(0,a.Z)(r,"key",e.key),(0,a.Z)(r,"value",Number(e.data)),r})),le(n||[]),ne(!1)),e.next=20;break;case 8:if(null==G||void 0===s){e.next=18;break}e.t0=G,e.next="value"===e.t0?12:"key"===e.t0?14:16;break;case 12:return s=_.sortBy(s,["value"]),e.abrupt("break",18);case 14:return s=_.sortBy(s,["key"]),e.abrupt("break",18);case 16:return s=s,e.abrupt("break",18);case 18:le(s||[]),ne(!1);case 20:case"end":return e.stop()}}),e)}))),[t]);return(0,u.useEffect)((function(){ie()}),[ie]),re?u.createElement(Z.Z,null):0===ce.length?u.createElement(j.Z,null):(console.log("===================================="),console.log(g),console.log("===================================="),u.createElement(u.Fragment,null,u.createElement("div",{style:{height:"".concat(n,"px")}},u.createElement(P.jM,(0,a.Z)({data:ce,margin:{top:30,right:30,bottom:30,left:30},indexBy:"key",colors:X&&$.length>0?$:"regagro"===g?S:"milk"===g?x:"milk2"===g?N:{scheme:g},colorBy:"index",layout:f,axisBottom:J&&{tickRotation:B},tooltip:function(e){return u.createElement(C.Z,{enable:U,datum:e,widgetID:Q})},enableGridX:A,enableGridY:z,enableLabel:O,reverse:h,groupMode:d,padding:w,innerPadding:T,borderRadius:W,borderWidth:M},"axisBottom",{tickSize:5,tickPadding:5,tickRotation:0,legend:"key",legendOffset:32})))))},q=r(78478),W=r(26568),I=r(53723),M=r(57167),F=function(e){var t=e.widget,r=e.width,n=void 0===r?350:r,a=e.height,o=void 0===a?450:a;switch(t.type){case w.u3:return u.createElement(T,{width:n,height:o,widget:t,isDashboard:!0});case w.en:return u.createElement(q.Z,{width:n,height:o,widget:t,isDashboard:!0});case w.fq:return u.createElement(W.Z,{width:n,height:o,widget:t,isDashboard:!0});case w.Fe:return u.createElement(I.Z,{width:n,height:o,widget:t,isDashboard:!0});case w.e_:return u.createElement(M.Z,{width:n,height:o,widget:t,isDashboard:!0});default:return u.createElement(u.Fragment,null)}};function G(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function R(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?G(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var B=function(e){var t=e.widget,r=e.setWidget,n=e.allowedTypes;return u.createElement(y.Z.Group,null,u.createElement(y.Z.Label,null,"Тип виджета"),u.createElement(y.Z.Control,{as:"select",custom:!0,value:t.type,onChange:function(e){return r(R(R({},t),{},{type:e.target.value}))}},n.map((function(e,t){return u.createElement("option",{key:t,value:e},(0,w.z$)(e))}))))};function L(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function J(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?L(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Y=function(e){var t,r=e.widget,n=e.setWidget,l=e.param,s=e.changeTitle,p=(0,u.useState)([]),d=(0,c.Z)(p,2),m=d[0],f=d[1],v=(0,u.useState)(!1),b=(0,c.Z)(v,2),h=(b[0],b[1]),O=(0,u.useCallback)(function(){var e=(0,o.Z)(i().mark((function e(t){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("KOSTYA =>",t),h(!0),e.next=4,g()("/ajax/models/queries/".concat(t.model,"/").concat(t.value));case 4:200===(r=e.sent).status&&(console.log(r.data.data),f(r.data.data),h(!1));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[l]);return(0,u.useEffect)((function(){0===m.length&&O(l)}),[l]),u.createElement(y.Z.Group,null,u.createElement(y.Z.Label,null,l.label),u.createElement(y.Z.Control,{as:"select",custom:!0,value:(null===(t=r.filter)||void 0===t?void 0:t[l.value])||"",onChange:function(e){var t=r.filter[l.value]||{},o=m.find((function(e){return e.value==t})),c=void 0!==o&&o.label;console.log(c,"<---"),n(J(J({},r),{},{filter:J(J({},r.filter),{},(0,a.Z)({},l.value,e.target.value))}));var i=m.find((function(t){return t.value==e.target.value})).label||"";s(" / ".concat(i)," / ".concat(c))},required:!0},u.createElement("option",{value:""},"-"),m.map((function(e){var t=e.value,r=e.label;return u.createElement("option",{key:t,value:t},r)}))))};function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function V(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var z=function(e){var t=e.widget,r=e.setWidget;return u.createElement(y.Z.Group,{className:"d-none"},u.createElement(y.Z.Label,null,"Легенда"),u.createElement(y.Z.Control,{as:"select",custom:!0,value:t.options.legend,onChange:function(e){return r(V(V({},t),{},{options:V(V({},t.options),{},{legend:e.target.value})}))},required:!0},u.createElement("option",{value:""},"Не показывать"),u.createElement("option",{value:"horizontal"},"Горизонтальная"),u.createElement("option",{value:"vertical"},"Вертикальная")))};function H(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function X(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?H(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var K=function(e){var t=e.widget,r=e.setWidget;return u.createElement(y.Z.Group,null,u.createElement(y.Z.Label,null,"Положение легенды"),u.createElement(y.Z.Control,{as:"select",custom:!0,value:t.options.legendPosition,onChange:function(e){return r(X(X({},t),{},{options:X(X({},t.options),{},{legendPosition:e.target.value,legend:"left"==e.target.value||"right"==e.target.value?"vertical":"horizontal"})}))},required:!0},u.createElement("option",{value:"bottom"},"Внизу"),u.createElement("option",{value:"left"},"Слева"),u.createElement("option",{value:"right"},"Справа"),u.createElement("option",{value:"top"},"Сверху")))};function $(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var U=function(e){var t=e.widget,r=e.setWidget,n=e.sources,a=e.changeTitle;return u.createElement(y.Z.Group,null,u.createElement(y.Z.Label,{className:{"d-none":1===n.length}},n.length>1||0==n.length?"Источник данных":"Источник данных: ".concat(n[0].name)),u.createElement(y.Z.Control,{as:"select",custom:!0,className:{"d-none":1===n.length},value:t.source,onChange:function(e){r(Q(Q({},t),{},{source:e.target.value}));var o=n.find((function(t){return t.url==e.target.value})).label||"";a(" / ".concat(o))},required:!0},u.createElement("option",{value:""},"-"),n.map((function(e){var t=e.url,r=e.name;return u.createElement("option",{key:t,value:t},r)}))))},ee=r(50274);function te(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function re(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?te(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):te(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ne=function(e){var t=e.widget,r=e.setWidget,a=Object.keys(ee.schemes).map((function(e){return{label:e,value:e}}));return a=[].concat((0,n.Z)(a),[{label:"Custom",value:"Custom"}]),u.createElement(y.Z.Group,{className:"d-none"},u.createElement(y.Z.Label,null,"Цветовая схема"),u.createElement(y.Z.Control,{as:"select",custom:!0,value:t.options.colorScheme,onChange:function(e){return r(re(re({},t),{},{options:re(re({},t.options),{},{colorScheme:e.target.value})}))},required:!0},a.map((function(e){var t=e.label,r=e.value;return u.createElement("option",{key:r,value:r},t)}))))};function ae(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function oe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ae(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ce=function(e){var t=e.widget,r=e.setWidget;return u.createElement(y.Z.Group,null,u.createElement(y.Z.Check,{type:"checkbox",checked:t.options.isVertical,label:"Вертикальная таблица",onChange:function(e){return r(oe(oe({},t),{},{options:oe(oe({},t.options),{},{isVertical:e.target.checked})}))}}))};function le(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ie(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?le(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):le(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ue=function(e){var t=e.widget,r=e.setWidget;return u.createElement(y.Z.Group,null,u.createElement(y.Z.Label,null,"Сортировка данных"),u.createElement(y.Z.Control,{as:"select",custom:!0,value:t.options.sort||0,onChange:function(e){return r(ie(ie({},t),{},{options:ie(ie({},t.options),{},{sort:e.target.value})}))},required:!0},[{label:"Без сортировки",value:0},{label:"По ключу",value:1},{label:"По значению",value:2}].map((function(e){var t=e.label,r=e.value;return u.createElement("option",{key:r,value:r},t)}))))};function se(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function pe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?se(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):se(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var de=function(e){var t,r,a,l,s=e.id,p=e.onAdd,d=e.setIsShow,m=e.settings,f=(0,u.useState)({type:w.Fe,source:"",options:{isVertical:!1,legend:"",legendPosition:"bottom",colorScheme:"Custom"},filter:{}}),v=(0,c.Z)(f,2),b=v[0],h=v[1],Z=(0,u.useRef)(""),j=function(){var e=(0,o.Z)(i().mark((function e(){var t,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=pe(pe({},b),{},{title:Z.current.value,options:JSON.stringify(b.options),filter:JSON.stringify(b.filter)}),console.log("ON SAVE =>",JSON.stringify(b.options),JSON.stringify(b.filter)),e.next=4,g().post("/ajax/dashboards/".concat(s),t);case 4:200===(r=e.sent).status&&(p(r.data),d(!1));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Z.current.value.includes(t)&&(Z.current.value=Z.current.value.replace(t,e)),Z.current.value.includes(e)||(Z.current.value+=e)},P=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e&&0!==e.length?e.map((function(e){return{name:e.label,url:"/ajax/models/queries/".concat(e.model,"/").concat(e.value)}})):[]};if(1===P(m.sql).length){var D=P(m.sql)[0];b.source=D.url,setTimeout((function(){return k("".concat(D.name))}),0)}return u.createElement(O.Z,null,u.createElement(O.Z.Header,null,u.createElement(O.Z.Title,null,"Добавить виджет")),u.createElement(O.Z.Body,null,u.createElement(y.Z,null,u.createElement(y.Z.Group,null,u.createElement(y.Z.Label,null,"Название виджета"),u.createElement(y.Z.Control,{type:"text",ref:Z,onFocus:function(e){"Новый виджет"===e.target.value&&(Z.current.value="")},onBlur:function(e){""===e.target.value&&(Z.current.value="Новый виджет")},defaultValue:"",required:!0})),u.createElement(U,{widget:b,setWidget:h,sources:P(m.sql),changeTitle:k}),u.createElement(ue,{widget:b,setWidget:h}),b.source&&(null===(t=m.filter)||void 0===t?void 0:t.length)>0&&(null===(r=m.filter)||void 0===r?void 0:r.map((function(e){return u.createElement(Y,{key:e.value,widget:b,setWidget:h,param:e,changeTitle:k})}))),u.createElement(B,{widget:b,setWidget:h,allowedTypes:[].concat((0,n.Z)(function(e){var t,r,n=e;n=n.includes("?")?n.split("?")[0]:e;var a=null===(t=m.sql)||void 0===t?void 0:t.find((function(e){return n==="/ajax/models/queries/".concat(e.model,"/").concat(e.value)}));return(null==a||null===(r=a.types)||void 0===r?void 0:r.map((function(e){return e.value})))||[]}(b.source)),[w.Fe])}),b.source&&b.type===w.Fe&&u.createElement(ce,{widget:b,setWidget:h}),u.createElement(ne,{widget:b,setWidget:h}),(null===(a=b.options)||void 0===a?void 0:a.legend)&&u.createElement(K,{widget:b,setWidget:h})),u.createElement("div",{className:"widget-placeholder altrp-chart ".concat(null===(l=b.options)||void 0===l?void 0:l.legendPosition)},b.source&&u.createElement(F,{widget:b,width:360,height:360}))),u.createElement(O.Z.Footer,null,u.createElement(E.Z,{variant:"secondary",onClick:function(){return d(!1)}},"Закрыть"),u.createElement(E.Z,{variant:"warning",onClick:j,disabled:""===b.source},"Сохранить")))},me=r(29306),fe=r.n(me),ve=r(29553),ge=r.n(ve),be=r(62876),he=r(91657),ye=r(52653),Oe=r(14575);function Ee(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function we(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ee(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ee(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ze=function(e){var t,r,a,l=e.data,s=e.onEdited,p=e.setIsEdit,d=e.settings,m=(0,u.useState)(l),f=(0,c.Z)(m,2),v=f[0],g=f[1],b=(0,u.useRef)(v.title),h=function(){var e=(0,o.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s(we(we({},v),{},{title:b.current.value})),p(!1);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e&&0!==e.length?e.map((function(e){return{name:e.label,url:"/ajax/models/queries/".concat(e.model,"/").concat(e.value)}})):[]},j=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];b.current.value.includes(t)&&(b.current.value=b.current.value.replace(t,e)),b.current.value.includes(e)||(b.current.value+=e)};if(1===Z(d.sql).length){var k=Z(d.sql)[0];v.source=k.url}return u.createElement(O.Z,null,u.createElement(O.Z.Header,null),u.createElement(O.Z.Body,null,u.createElement(y.Z,null,u.createElement(y.Z.Group,null,u.createElement(y.Z.Label,null,"Название виджета"),u.createElement(y.Z.Control,{type:"text",ref:b,defaultValue:v.title,required:!0})),u.createElement(U,{widget:v,setWidget:g,sources:Z(d.sql),changeTitle:j}),u.createElement(ue,{widget:v,setWidget:g}),v.source&&(null===(t=d.filter)||void 0===t?void 0:t.length)>0&&(null===(r=d.filter)||void 0===r?void 0:r.map((function(e){return u.createElement(Y,{key:e.value,widget:v,setWidget:g,param:e,changeTitle:j})}))),u.createElement(B,{widget:v,setWidget:g,allowedTypes:[].concat((0,n.Z)(function(e){var t,r,n=e;n=n.includes("?")?n.split("?")[0]:e;var a=d&&(null===(t=d.sql)||void 0===t?void 0:t.find((function(e){return n==="/ajax/models/queries/".concat(e.model,"/").concat(e.value)})));return(null==a||null===(r=a.types)||void 0===r?void 0:r.map((function(e){return e.value})))||[]}(v.source)),[w.Fe])}),v.source&&v.type===w.Fe&&u.createElement(ce,{widget:v,setWidget:g}),u.createElement(ne,{widget:v,setWidget:g}),u.createElement(z,{widget:v,setWidget:g}),u.createElement(K,{widget:v,setWidget:g})),u.createElement("div",{className:"widget-placeholder altrp-chart ".concat(null===(a=v.options)||void 0===a?void 0:a.legendPosition)},v.source&&u.createElement(F,{widget:v,width:360,height:360}))),u.createElement(O.Z.Footer,null,u.createElement(E.Z,{variant:"secondary",onClick:function(){return p(!1)}},"Закрыть"),u.createElement(E.Z,{variant:"warning",onClick:h,disabled:""===v.source},"Сохранить")))},je=u.memo(Ze);r(80147);var ke=function(e){var t,r=e.widget,n=e.onDeleted,a=e.onEdited,l=e.settings,p=(e.isMobile,(0,u.useState)(!1)),d=(0,c.Z)(p,2),m=d[0],f=d[1],v=(0,u.useRef)(null),g=function(){var e=(0,o.Z)(i().mark((function e(){var t,r,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=v.current.querySelector(".card-body"),e.next=3,fe().toPng(t);case 3:r=e.sent,(n=document.createElement("a")).download="widget_".concat((new Date).getTime(),".png"),n.href=r,n.click();case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return u.createElement(O.Z,{key:r.id,ref:v},u.createElement(O.Z.Header,null,u.createElement(O.Z.Title,null,r.title),u.createElement(O.Z.Title,null,u.createElement("div",{className:"dropdownTogglerContainer"},u.createElement(s.Z,{drop:"left"},u.createElement(s.Z.Toggle,{variant:"light"},u.createElement(h.Z,{color:"#7a7a7b"})),u.createElement(s.Z.Menu,{className:"dropdownMenuToggle",style:{zIndex:999999,background:"rgba(255,255,255,1)"}},u.createElement(s.Z.Item,null,u.createElement(ge(),{trigger:function(){return u.createElement("button",{type:"button",title:"Распечатать виджет"},u.createElement(ye.Z,null))},content:function(){return v.current}})),u.createElement(s.Z.Item,null,u.createElement("button",{type:"button",title:"Скачать файл",onClick:g},u.createElement(Oe.Z,null))),u.createElement(s.Z.Item,null,u.createElement("button",{type:"button",title:"Настроить виджет",onClick:function(){return f(!m)}},u.createElement(be.Z,null))),u.createElement(s.Z.Item,null,u.createElement("button",{type:"button",title:"Удалить виджет",onClick:function(){return n(r)}},u.createElement(he.Z,null)))))))),u.createElement(O.Z.Body,{className:"altrp-chart ".concat(null===(t=r.options)||void 0===t?void 0:t.legendPosition)},m?u.createElement(je,{settings:l,data:r,onEdited:a,setIsEdit:f}):u.createElement(F,{widget:r,width:360,height:300})))},Pe=r(6610),De=r(5991),Ce=r(10379),Se=r(46070),xe=r(77608);var Ne=function(e){(0,Ce.Z)(c,e);var t,r,n,a=(r=c,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,xe.Z)(r);if(n){var a=(0,xe.Z)(this).constructor;e=Reflect.construct(t,arguments,a)}else e=t.apply(this,arguments);return(0,Se.Z)(this,e)});function c(e){var t;return(0,Pe.Z)(this,c),(t=a.call(this,e)).state={options:[]},t}return(0,De.Z)(c,[{key:"componentDidMount",value:(t=(0,o.Z)(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g()("/ajax/models/queries/".concat(this.props.parameter.model,"/").concat(this.props.parameter.value));case 2:200===(t=e.sent).status?this.setState({options:t.data.data}):this.setState({options:[]});case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this;return u.createElement(y.Z.Control,{as:"select",className:"global-select",onChange:function(t){e.props.setGlobalOption(e.props.parameter.value,t.target.value),t.preventDefault(),t.stopPropagation()},custom:!0},u.createElement("option",{value:""},this.props.parameter.label),this.state.options.map((function(e,t){var r=e.id,n=e.name,a=e.value,o=e.label;return u.createElement("option",{key:t,value:a||r},o||n)})))}}]),c}(Component);function Te(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function qe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Te(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Te(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}r(53524),(0,d.registerLocale)("ru",b.Z),(0,d.setDefaultLocale)("ru");var We=function(e){var t=e.id,r=e.settings,l=e.globalParameter,d=(new Date).setFullYear((new Date).getFullYear()-1),v=(new Date).getTime(),b=(0,u.useState)([]),y=(0,c.Z)(b,2),O=y[0],E=y[1],w=(0,u.useState)(!1),Z=(0,c.Z)(w,2),j=Z[0],k=Z[1],P=(0,u.useState)(d),D=(0,c.Z)(P,2),C=D[0],S=D[1],x=(0,u.useState)(v),N=(0,c.Z)(x,2),T=N[0],q=N[1],W=screen.width<=480,I=function(){var e=(0,o.Z)(i().mark((function e(t){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g()("/ajax/dashboards/".concat(t,"/settings"),{headers:[{key:"Cache-Control",value:"no-store"}]});case 3:if(200!==(r=e.sent).status){e.next=9;break}return console.log("req.data :>> ",r.data),e.abrupt("return",JSON.parse(r.data.settings));case 9:return e.abrupt("return",{});case 10:e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",{});case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t){return e.apply(this,arguments)}}(),M=function(){var e=(0,o.Z)(i().mark((function e(t){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g()("/ajax/dashboards/".concat(t),{headers:[{key:"Cache-Control",value:"no-store"}]});case 3:if(200!==(r=e.sent).status){e.next=9;break}return console.log("req.data DASHBOARDS:>> ",r.data),e.abrupt("return",r.data);case 9:return e.abrupt("return",[]);case 10:e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",[]);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t){return e.apply(this,arguments)}}(),F=(0,u.useCallback)(function(){var e=(0,o.Z)(i().mark((function e(t,n,a){var o,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M(t);case 3:return o=e.sent,e.next=6,I(t);case 6:null!==(c=e.sent)&&c.hasOwnProperty("startDate")&&c.hasOwnProperty("endDate")?(E(o.map((function(e){return qe(qe({},e),{},{options:qe(qe({},JSON.parse(e.options)),{},{animated:r.animated}),filter:qe(qe({},JSON.parse(e.filter)),c)})}))),S(c.startDate),q(c.endDate)):(E(o.map((function(e){return qe(qe({},e),{},{options:qe(qe({},JSON.parse(e.options)),{},{animated:r.animated}),filter:qe(qe({},JSON.parse(e.filter)),{},{startDate:n,endDate:a})})}))),g().post("/ajax/dashboards/".concat(t,"/settings"),{settings:{startDate:n,endDate:a}},{headers:[{key:"Cache-Control",value:"no-store"}]})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,r,n){return e.apply(this,arguments)}}(),[t,r.animated,C,T]),G=function(e){E(O.filter((function(t){return t.id!==e.id}))),g().delete("/ajax/dashboards/".concat(e.id),{headers:[{key:"Cache-Control",value:"no-store"}]})},R=function(e){E(O.map((function(t){return t.id===e.id?e:t}))),g().put("/ajax/dashboards/".concat(e.id),qe(qe({},e),{},{options:JSON.stringify(e.options),filter:JSON.stringify(e.filter)}),{headers:[{key:"Cache-Control",value:"no-store"}]})},B=function(e){S(e.getTime()),g().post("/ajax/dashboards/".concat(t,"/settings"),{settings:{startDate:e.getTime(),endDate:T}},{headers:[{key:"Cache-Control",value:"no-store"}]})},L=function(e){q(e.getTime()),g().post("/ajax/dashboards/".concat(t,"/settings"),{settings:{startDate:C,endDate:e.getTime()}},{headers:[{key:"Cache-Control",value:"no-store"}]})},J=function(){var e=(0,f.Z)(T,{weeks:1}).getTime();S(e),g().post("/ajax/dashboards/".concat(t,"/settings"),{settings:{startDate:e,endDate:T}},{headers:[{key:"Cache-Control",value:"no-store"}]})},_=function(){var e=(0,f.Z)(T,{months:1}).getTime();S(e),g().post("/ajax/dashboards/".concat(t,"/settings"),{settings:{startDate:e,endDate:T}},{headers:[{key:"Cache-Control",value:"no-store"}]})},Y=function(e,t){E(O.map((function(r){return qe(qe({},r),{},{filter:qe(qe({},r.filter),{},(0,a.Z)({},e,t))})})))};return(0,u.useEffect)((function(){F(t,C,T)}),[t,C,T]),u.createElement("div",{className:"altrp-dashboard"},u.createElement("div",{className:"altrp-dashboard__controls"},W?u.createElement(s.Z,null,u.createElement(s.Z.Toggle,{variant:"light"},u.createElement(h.Z,{color:"#7a7a7b"})),u.createElement(s.Z.Menu,null,u.createElement(s.Z.Item,{onClick:function(){return k(!0)}},"Добавить виджет"),u.createElement(s.Z.Divider,null),u.createElement(s.Z.Item,{onClick:J},"Неделя"),u.createElement(s.Z.Item,{onClick:_},"Месяц"),u.createElement(s.Z.Divider,null),u.createElement(s.Z.ItemText,{as:"div"},u.createElement(m(),{closeOnScroll:!0,className:"form-control first",popperClassName:"datepicker-popper-mobile",popperPlacement:"bottom-end",selected:C,selectsStart:!0,onChange:B,dateFormat:"dd.MM.yyyy",showYearDropdown:!0})),u.createElement(s.Z.ItemText,{as:"div"},u.createElement(m(),{closeOnScroll:!0,className:"form-control last",popperClassName:"datepicker-popper-mobile",popperPlacement:"bottom-end",selected:T,minDate:C,selectsEnd:!0,onChange:L,dateFormat:"dd.MM.yyyy",showYearDropdown:!0})),u.createElement(s.Z.Divider,null),l&&l.map((function(e,t){return u.createElement(s.Z.Item,{onClick:function(e){e.stopPropagation(),e.preventDefault()},key:t},u.createElement(Ne,{settings:r,setGlobalOption:Y,parameter:e}))})))):u.createElement(p.Z,{className:"jusitfy-content-end"},u.createElement(p.Z.Item,{className:"nav-button",onClick:function(){return k(!0)}},"Добавить виджет"),u.createElement(p.Z.Item,{className:"nav-datepickers"},u.createElement("div",{className:"nav-datepicker"},u.createElement(m(),{closeOnScroll:!0,className:"form-control first",popperClassName:"datepicker-popper-mobile",popperPlacement:"bottom-end",selected:C,selectsStart:!0,onChange:B,dateFormat:"dd.MM.yyyy",showYearDropdown:!0})),u.createElement("div",{className:"nav-datepicker"},u.createElement(m(),{closeOnScroll:!0,className:"form-control last",popperClassName:"datepicker-popper-mobile",popperPlacement:"bottom-end",selected:T,minDate:C,selectsEnd:!0,onChange:L,dateFormat:"dd.MM.yyyy",showYearDropdown:!0}))),u.createElement(p.Z.Item,{className:"nav-button",onClick:J},"Неделя"),u.createElement(p.Z.Item,{className:"nav-button",onClick:_},"Месяц"),l&&l.map((function(e,t){return u.createElement(p.Z.Item,{key:t},u.createElement(Ne,{settings:r,setGlobalOption:Y,parameter:e}))})))),u.createElement("div",{className:"altrp-dashboard__widgets"},j&&u.createElement(de,{settings:r,id:t,setIsShow:k,onAdd:function(e){E([e].concat((0,n.Z)(O)))}}),O.map((function(e){return u.createElement(ke,{settings:r,key:e.id,widget:e,onDeleted:G,onEdited:R,isMobile:W})}))))}}}]);
//# sourceMappingURL=7460.editor.js.map