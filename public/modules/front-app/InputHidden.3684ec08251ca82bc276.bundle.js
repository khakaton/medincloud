(self.webpackChunk=self.webpackChunk||[]).push([[6153],{71743:function(e,t,r){"use strict";var a=r(6610),_=r(5991),n=r(83465),o=r.n(n),s=r(29208),i=r.n(s),p=r(31468),l=r.n(p),c=r(38394),u=r.n(c),d=r(96633),h=r.n(d),g=r(99245),f=r.n(g),m=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.Z)(this,e),this.data=o()(t)}return(0,_.Z)(e,[{key:"getData",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return e?o()(this.data):this.data}},{key:"isEmpty",value:function(){return f()(this.data)}},{key:"getProperty",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return i()(this.data,e,t)}},{key:"hasProperty",value:function(e){return u()(this.data,e)}},{key:"setProperty",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return r instanceof e&&(r=r.getData(!1)),l()(this.data,t,r)}},{key:"unsetProperty",value:function(e){return h()(this.data,e)}}]),e}();window.AltrpModel=m,t.Z=m},53310:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(85061),_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(96156),_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(92137),_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(6610),_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(5991),_babel_runtime_helpers_assertThisInitialized__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(63349),_babel_runtime_helpers_inherits__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(10379),_babel_runtime_helpers_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(46070),_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(77608),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(87757),_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1__),react__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(67294),_classes_Resource__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(38773),_front_app_src_js_store_forms_data_storage_actions__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(48379),_classes_AltrpModel__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(71743);function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){(0,_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0__.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var r,a=(0,_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_2__.Z)(e);if(t){var _=(0,_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_2__.Z)(this).constructor;r=Reflect.construct(a,arguments,_)}else r=a.apply(this,arguments);return(0,_babel_runtime_helpers_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_3__.Z)(this,r)}}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var _window$altrpHelpers=window.altrpHelpers,convertData=_window$altrpHelpers.convertData,isEditor=_window$altrpHelpers.isEditor,parseOptionsFromSettings=_window$altrpHelpers.parseOptionsFromSettings,parseParamsFromString=_window$altrpHelpers.parseParamsFromString,renderIcon=_window$altrpHelpers.renderIcon,replaceContentWithData=_window$altrpHelpers.replaceContentWithData,getDataFromLocalStorage=_window$altrpHelpers.getDataFromLocalStorage,FromIcon=function(e){return react__WEBPACK_IMPORTED_MODULE_4__.createElement("svg",e,react__WEBPACK_IMPORTED_MODULE_4__.createElement("title",null,"form-horizontal"),react__WEBPACK_IMPORTED_MODULE_4__.createElement("path",{d:"M.672 1.344h30.656c.384 0 .672-.32.672-.672S31.712 0 31.328 0H.672C.288 0 0 .288 0 .672s.288.672.672.672zM31.328 4H.672C.288 4 0 4.288 0 4.672s.288.672.672.672h30.656c.384 0 .672-.32.672-.672S31.712 4 31.328 4zm0 4H.672A.656.656 0 0 0 0 8.672v16c0 .352.288.672.672.672h30.656c.384 0 .672-.32.672-.672v-16A.656.656 0 0 0 31.328 8zM1.344 9.344h29.312v11.04L27.072 24H1.344V9.344zM28.96 24l1.696-1.728V24H28.96zM9.344 26.656H2.656C1.184 26.656 0 27.872 0 29.344S1.184 32 2.656 32h6.688C10.816 32 12 30.816 12 29.344s-1.184-2.688-2.656-2.688zm0 4H2.656c-.736 0-1.312-.576-1.312-1.312S1.92 28 2.656 28h6.688c.736 0 1.312.608 1.312 1.344s-.576 1.312-1.312 1.312z"}))};FromIcon.defaultProps={xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},(window.globalDefaults=window.globalDefaults||[]).push("\n /*здесь css стилей по умолчанию с селекторами*/\n");var InputHiddenWidget=function(_Component){(0,_babel_runtime_helpers_inherits__WEBPACK_IMPORTED_MODULE_7__.Z)(InputHiddenWidget,_Component);var _super=_createSuper(InputHiddenWidget),_updateOptions,_componentDidUpdate2,_componentDidMount2;function InputHiddenWidget(e){var t;return(0,_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_8__.Z)(this,InputHiddenWidget),(t=_super.call(this,e)).timeInput=null,t.handleEnter=function(e){if(13===e.keyCode){e.preventDefault();var r=Array.from(document.querySelectorAll("input,select")),a=r.indexOf(e.target);if(void 0===a)return;r[a+1]&&r[a+1].focus();var _=t.props.element.getSettings(),n=_.create_allowed,o=_.create_label,s=_.create_url;n&&o&&s&&t.createItem(e)}},t.debounceDispatch=_.debounce((function(e){return t.dispatchFieldValueToStore(e,!0)}),150),t.dispatchFieldValueToStore=function(){var e=(0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_9__.Z)(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().mark((function e(r){var a,n,o,s,i,p=arguments;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=p.length>1&&void 0!==p[1]&&p[1],n=t.props.element.getFormId(),-1!==(o=t.props.element.getFieldId()).indexOf("{{")&&(o=replaceContentWithData(o)),!(_.isObject(t.props.appStore)&&o&&n)){e.next=14;break}if(t.props.appStore.dispatch((0,_front_app_src_js_store_forms_data_storage_actions__WEBPACK_IMPORTED_MODULE_10__.Az)(o,r,n,a)),!a){e.next=14;break}if(!(s=t.props.element.getSettings("change_actions"))||isEditor()){e.next=14;break}return e.next=11,Promise.all([__webpack_require__.e(4079),__webpack_require__.e(6593),__webpack_require__.e(2167),__webpack_require__.e(6737)]).then(__webpack_require__.bind(__webpack_require__,2167));case 11:return i=e.sent.default,e.next=14,i.callAllWidgetActions(t.props.element.getIdForAction(),"change",s,t.props.element);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.getValue=function(){var e=t.props.element.getFormId(),r=t.props.element.getFieldId();return isEditor()?t.state.value:_.get(appStore.getState(),"formsStore.".concat(e,".").concat(r),"")},e.element.component=(0,_babel_runtime_helpers_assertThisInitialized__WEBPACK_IMPORTED_MODULE_11__.Z)(t),window.elementDecorator&&window.elementDecorator((0,_babel_runtime_helpers_assertThisInitialized__WEBPACK_IMPORTED_MODULE_11__.Z)(t)),t.onChange=t.onChange.bind((0,_babel_runtime_helpers_assertThisInitialized__WEBPACK_IMPORTED_MODULE_11__.Z)(t)),t.debounceDispatch=t.debounceDispatch.bind((0,_babel_runtime_helpers_assertThisInitialized__WEBPACK_IMPORTED_MODULE_11__.Z)(t)),t.defaultValue=t.getContent("content_default_value")||"",t.state={settings:_objectSpread({},e.element.getSettings()),value:t.defaultValue,options:parseOptionsFromSettings(e.element.getSettings("content_options")),paramsForUpdate:null},t.altrpSelectRef=react__WEBPACK_IMPORTED_MODULE_4__.createRef(),t.getContent("content_default_value")&&t.dispatchFieldValueToStore(t.getContent("content_default_value")),t}return(0,_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_12__.Z)(InputHiddenWidget,[{key:"clearValue",value:function(){this.onChange(""),this.dispatchFieldValueToStore("",!0)}},{key:"_componentDidMount",value:(_componentDidMount2=(0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_9__.Z)(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().mark((function e(t,r){var a,n,o=this;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.element.getSettings("content_options")&&(a=parseOptionsFromSettings(this.props.element.getSettings("content_options")),this.setState((function(e){return _objectSpread(_objectSpread({},e),{},{options:a})}))),n=this.state.value,_.get(n,"dynamic")&&this.props.currentModel.getProperty("altrpModelUpdated")&&(n=this.getContent("content_default_value")),!t||t.currentModel.getProperty("altrpModelUpdated")||!this.props.currentModel.getProperty("altrpModelUpdated")){e.next=7;break}return n=this.getContent("content_default_value"),this.setState((function(e){return _objectSpread(_objectSpread({},e),{},{value:n,contentLoaded:!0})}),(function(){o.dispatchFieldValueToStore(n)})),e.abrupt("return");case 7:if(!this.props.currentModel.getProperty("altrpModelUpdated")||!this.props.currentDataStorage.getProperty("currentDataStorageLoaded")||this.state.contentLoaded){e.next=11;break}return n=this.getContent("content_default_value"),this.setState((function(e){return _objectSpread(_objectSpread({},e),{},{value:n,contentLoaded:!0})}),(function(){o.dispatchFieldValueToStore(n)})),e.abrupt("return");case 11:this.state.value!==n&&this.setState((function(e){return _objectSpread(_objectSpread({},e),{},{value:n})}),(function(){o.dispatchFieldValueToStore(n)}));case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return _componentDidMount2.apply(this,arguments)})},{key:"getRoute",value:function(){var e=this.props.element.getSettings("model_for_options");return-1===e.indexOf("/")?"/ajax/models/".concat(e,"_options"):(-1!==e.indexOf("{{")&&(e=replaceContentWithData(e)),e)}},{key:"_componentDidUpdate",value:(_componentDidUpdate2=(0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_9__.Z)(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().mark((function e(t,r){var a,n,o,s,i,p=this;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=this.state.settings,n=a.content_options,o=a.model_for_options,t&&!t.currentDataStorage.getProperty("currentDataStorageLoaded")&&this.props.currentDataStorage.getProperty("currentDataStorageLoaded")&&(s=this.getContent("content_default_value",this.props.element.getSettings("select2_multiple")),this.setState((function(e){return _objectSpread(_objectSpread({},e),{},{value:s,contentLoaded:!0})}),(function(){p.dispatchFieldValueToStore(s)}))),!_.isEqual(this.props.currentModel,t.currentModel)&&this.state.value&&this.state.value.dynamic&&this.dispatchFieldValueToStore(this.getContent("content_default_value")),this.props.formsStore===t.formsStore&&this.props.currentModel===t.currentModel&&this.props.currentDataStorage===t.currentDataStorage||this.updateOptions(),n&&!o&&(i=parseOptionsFromSettings(n),_.isEqual(i,this.state.options)||this.setState((function(e){return _objectSpread(_objectSpread({},e),{},{options:i})}))),this.updateValue(t);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return _componentDidUpdate2.apply(this,arguments)})},{key:"updateValue",value:function updateValue(prevProps){var _this4=this;if(!isEditor()){var content_calculation=this.props.element.getSettings("content_calculation"),altrpforms=this.props.formsStore,fieldName=this.props.element.getFieldId(),formId=this.props.element.getFormId();if(content_calculation){var prevContext={},altrpdata=this.props.currentDataStorage.getData(),altrpmodel=this.props.currentModel.getData(),altrpuser=this.props.currentUser.getData(),altrppagestate=this.props.altrpPageState.getData(),altrpresponses=this.props.altrpresponses.getData(),altrpmeta=this.props.altrpMeta.getData(),context=this.props.element.getCurrentModel().getData();if(-1!==content_calculation.indexOf("altrpdata")&&(context.altrpdata=altrpdata,altrpdata.currentDataStorageLoaded?prevContext.altrpdata=prevProps.currentDataStorage.getData():prevContext.altrpdata=altrpdata),-1!==content_calculation.indexOf("altrpforms")&&(context.altrpforms=altrpforms,"".concat(formId,".").concat(fieldName)===altrpforms.changedField?prevContext.altrpforms=altrpforms:prevContext.altrpforms=prevProps.formsStore),-1!==content_calculation.indexOf("altrpmodel")&&(context.altrpmodel=altrpmodel,prevContext.altrpmodel=prevProps.currentModel.getData()),-1!==content_calculation.indexOf("altrpuser")&&(context.altrpuser=altrpuser,prevContext.altrpuser=prevProps.currentUser.getData()),-1!==content_calculation.indexOf("altrpuser")&&(context.altrpuser=altrpuser,prevContext.altrpuser=prevProps.currentUser.getData()),-1!==content_calculation.indexOf("altrppagestate")&&(context.altrppagestate=altrppagestate,prevContext.altrppagestate=prevProps.altrpPageState.getData()),-1!==content_calculation.indexOf("altrpmeta")&&(context.altrpmeta=altrpmeta,prevContext.altrpmeta=prevProps.altrpMeta.getData()),-1!==content_calculation.indexOf("altrpresponses")&&(context.altrpresponses=altrpresponses,prevContext.altrpresponses=prevProps.altrpresponses.getData()),-1!==content_calculation.indexOf("altrpstorage")&&(context.altrpstorage=getDataFromLocalStorage("altrpstorage",{})),!(_.isEqual(prevProps.currentDataStorage,this.props.currentDataStorage)&&_.isEqual(prevProps.currentUser,this.props.currentUser)&&_.isEqual(prevProps.formsStore,this.props.formsStore)&&_.isEqual(prevProps.altrpPageState,this.props.altrpPageState)&&_.isEqual(prevProps.altrpMeta,this.props.altrpMeta)&&_.isEqual(prevProps.altrpresponses,this.props.altrpresponses)&&_.isEqual(prevProps.currentModel,this.props.currentModel))&&(_.isEqual(prevProps.formsStore,this.props.formsStore)||"".concat(formId,".").concat(fieldName)!==altrpforms.changedField)){var value="";try{if(content_calculation=content_calculation.replace(/}}/g,"')").replace(/{{/g,"_.get(context, '"),value=eval(content_calculation),value===this.state.value)return;this.setState((function(e){return _objectSpread(_objectSpread({},e),{},{value:value})}),(function(){_this4.dispatchFieldValueToStore(value)}))}catch(e){console.error("Evaluate error in Input "+e.message,this.props.element.getId())}}}else{var path="".concat(formId,".").concat(fieldName);this.props.formsStore!==prevProps.formsStore&&_.get(altrpforms,path)!==this.state.value&&this.setState((function(e){return _objectSpread(_objectSpread({},e),{},{value:_.get(altrpforms,path)})}))}}}},{key:"updateOptions",value:(_updateOptions=(0,_babel_runtime_helpers_asyncToGenerator__WEBPACK_IMPORTED_MODULE_9__.Z)(_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().mark((function e(){var t,r,a,n;return _babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.element.getFormId(),r=this.props.element.getSettings("params_for_update"),a=_.get(this.props.formsStore,[t],{}),r=parseParamsFromString(r,new _classes_AltrpModel__WEBPACK_IMPORTED_MODULE_6__.Z(a)),n=(0,_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_13__.Z)(this.state.options),_.isEqual(r,this.state.paramsForUpdate)){e.next=28;break}if(_.isEmpty(r)){e.next=21;break}if(!this.props.element.getSettings("params_as_filters",!1)){e.next=14;break}return r=JSON.stringify(r),e.next=11,new _classes_Resource__WEBPACK_IMPORTED_MODULE_5__.Z({route:this.getRoute()}).getQueried({filters:r});case 11:n=e.sent,e.next=17;break;case 14:return e.next=16,new _classes_Resource__WEBPACK_IMPORTED_MODULE_5__.Z({route:this.getRoute()}).getQueried(r);case 16:n=e.sent;case 17:n=_.isArray(n)?n:n.data,n=_.isArray(n)?n:[],e.next=27;break;case 21:if(!this.state.paramsForUpdate){e.next=27;break}return e.next=24,new _classes_Resource__WEBPACK_IMPORTED_MODULE_5__.Z({route:this.getRoute()}).getAll();case 24:n=e.sent,n=_.isArray(n)?n:n.data,n=_.isArray(n)?n:[];case 27:this.setState((function(e){return _objectSpread(_objectSpread({},e),{},{paramsForUpdate:r,options:n})}));case 28:case"end":return e.stop()}}),e,this)}))),function(){return _updateOptions.apply(this,arguments)})},{key:"onChange",value:function(e){var t,r=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n="";e&&e.target&&(n=e.target.value),e&&e.value&&(n=e.value),_.get(a,"getData")&&(n='<div class="ck ck-content" style="width:100%">'.concat(a.getData(),"</div>")),_.isArray(e)&&(n=_.cloneDeep(e)),this.props.element.getSettings("content_options_nullable")&&e&&"<null>"===e.value&&(n=null),this.setState((function(e){return _objectSpread(_objectSpread({},e),{},{value:n})}),(function(){var e=r.props.element.getSettings("change_actions"),a=r.props.element.getSettings("change_change_end"),_=r.props.element.getSettings("change_change_end_delay");!e||a||isEditor()||r.debounceDispatch(void 0!==t?t:n),e&&a&&!isEditor()&&(r.timeInput&&clearTimeout(r.timeInput),r.timeInput=setTimeout((function(){r.debounceDispatch(void 0!==t?t:n)}),_))}))}},{key:"getOptions",value:function(){var e=(0,_babel_runtime_helpers_toConsumableArray__WEBPACK_IMPORTED_MODULE_13__.Z)(this.state.options),t=this.props.element.getDynamicSetting("content_options");return t&&(e=convertData(t,e)),this.props.element.getSettings("sort_default")||(e=_.sortBy(e,(function(e){return e&&(e.label?e.label.toString():e)}))),e}},{key:"getName",value:function(){return"".concat(this.props.element.getFormId(),"[").concat(this.props.element.getFieldId(),"]")}},{key:"render",value:function(){if(isEditor())return react__WEBPACK_IMPORTED_MODULE_4__.createElement(FromIcon,null);var e=this.getValue();return react__WEBPACK_IMPORTED_MODULE_4__.createElement("input",{value:e,type:"hidden",name:this.getName(),id:this.getName()})}}]),InputHiddenWidget}(Component);__webpack_exports__.default=InputHiddenWidget}}]);
//# sourceMappingURL=InputHidden.3684ec08251ca82bc276.bundle.js.map