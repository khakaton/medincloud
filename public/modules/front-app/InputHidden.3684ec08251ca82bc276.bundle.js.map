{"version":3,"sources":["webpack:///./resources/modules/editor/src/js/classes/AltrpModel.js","webpack:///./resources/modules/editor/src/js/components/widgets/InputHiddenWidget.js"],"names":["AltrpModel","data","this","cloneDeep","clone","isEmpty","name","defaultValue","get","has","value","getData","set","unset","window","altrpHelpers","convertData","isEditor","parseOptionsFromSettings","parseParamsFromString","renderIcon","replaceContentWithData","getDataFromLocalStorage","FromIcon","globalDefaults","push","InputHiddenWidget","props","timeInput","handleEnter","e","keyCode","preventDefault","inputs","Array","from","document","querySelectorAll","index","indexOf","target","undefined","focus","element","getSettings","create_allowed","create_label","create_url","createItem","debounceDispatch","_","debounce","dispatchFieldValueToStore","userInput","formId","getFormId","fieldName","getFieldId","isObject","appStore","dispatch","changeFormFieldValue","change_actions","actionsManager","default","callAllWidgetActions","getIdForAction","getValue","state","getState","component","elementDecorator","onChange","bind","getContent","settings","options","paramsForUpdate","altrpSelectRef","React","prevProps","prevState","setState","currentModel","getProperty","contentLoaded","currentDataStorage","url","content_options","model_for_options","isEqual","dynamic","formsStore","updateOptions","updateValue","content_calculation","altrpforms","prevContext","altrpdata","altrpmodel","altrpuser","currentUser","altrppagestate","altrpPageState","altrpresponses","altrpmeta","altrpMeta","context","getCurrentModel","currentDataStorageLoaded","changedField","altrpstorage","replace","eval","console","error","message","getId","path","formData","JSON","stringify","Resource","route","getRoute","getQueried","filters","isArray","getAll","valueToDispatch","editor","change_change_end","change_change_end_delay","clearTimeout","setTimeout","optionsDynamicSetting","getDynamicSetting","sortBy","o","label","toString","type","getName","id","Component"],"mappings":"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","file":"InputHidden.3684ec08251ca82bc276.bundle.js","sourcesContent":["/**\r\n * Имеет интерфейс для доступы к свойствам data (любой вложенности)\r\n * @class AltrpModel\r\n */\r\nimport cloneDeep from 'lodash.clonedeep';\r\nimport get from 'lodash.get';\r\nimport set from 'lodash.set';\r\nimport has from 'lodash.has';\r\nimport unset from 'lodash.unset';\r\nimport isEmpty from 'lodash.isempty';\r\n// import {cloneDeep, get, set, has, unset, isString, isEmpty} from \"lodash\";\r\n\r\nclass AltrpModel {\r\n  constructor(data = {}) {\r\n    this.data = cloneDeep(data);\r\n  }\r\n\r\n  /**\r\n   * Возваращает объект данных\r\n   * @params {boolean} clone - клонировать или ссылку на данные\r\n   * @return {{}}\r\n   */\r\n  getData(clone = true) {\r\n    if(clone){\r\n      return cloneDeep(this.data);\r\n    }\r\n    return this.data;\r\n  }\r\n\r\n  /**\r\n   * Пустой ли объект\r\n   */\r\n  isEmpty(){\r\n    return isEmpty(this.data);\r\n  }\r\n  /**\r\n   * Возврашает значение свойства name\r\n   * @params {string} name\r\n   * @params {*} defaultValue\r\n   * @return {*}\r\n   */\r\n  getProperty(name, defaultValue = '') {\r\n    return get(this.data, name, defaultValue);\r\n  }\r\n  /**\r\n   * Возврашает значение свойства name\r\n   * @params {string} name\r\n   * @params {*} defaultValue\r\n   * @return {*}\r\n   */\r\n  hasProperty(name, defaultValue = '') {\r\n    return has(this.data, name);\r\n  }\r\n  /**\r\n   * Возврашает значение свойства name\r\n   * @params {string} name\r\n   * @params {*} defaultValue\r\n   * @return {{}}\r\n   */\r\n  setProperty(name, value = '') {\r\n    if(value instanceof AltrpModel){\r\n      value = value.getData(false);\r\n    }\r\n    return set(this.data, name, value);\r\n  }\r\n  /**\r\n   * Удаляет свойства name\r\n   * @params {string} name\r\n   * @return {*}\r\n   */\r\n  unsetProperty(name) {\r\n    return unset(this.data, name);\r\n  }\r\n}\r\nwindow.AltrpModel = AltrpModel;\r\nexport default AltrpModel\r\n","const {\r\n  convertData,\r\n  isEditor,\r\n  parseOptionsFromSettings,\r\n  parseParamsFromString,\r\n  renderIcon,\r\n  replaceContentWithData,\r\n  getDataFromLocalStorage\r\n} = window.altrpHelpers;\r\nimport Resource from \"../../classes/Resource\";\r\nimport { changeFormFieldValue } from \"../../../../../front-app/src/js/store/forms-data-storage/actions\";\r\nimport AltrpModel from \"../../classes/AltrpModel\";\r\nimport FromIcon from \"../../../svgs/form-horizontal.svg\";\r\n\r\n\r\n(window.globalDefaults = window.globalDefaults || []).push(`\r\n /*здесь css стилей по умолчанию с селекторами*/\r\n`)\r\n\r\n\r\nclass InputHiddenWidget extends Component {\r\n  timeInput = null;\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    props.element.component = this;\r\n    if (window.elementDecorator) {\r\n      window.elementDecorator(this);\r\n    }\r\n    this.onChange = this.onChange.bind(this);\r\n    this.debounceDispatch = this.debounceDispatch.bind(this);\r\n\r\n    this.defaultValue = this.getContent(\"content_default_value\") || \"\";\r\n    this.state = {\r\n      settings: { ...props.element.getSettings() },\r\n      value: this.defaultValue,\r\n      options: parseOptionsFromSettings(\r\n        props.element.getSettings(\"content_options\")\r\n      ),\r\n      paramsForUpdate: null\r\n    };\r\n    this.altrpSelectRef = React.createRef();\r\n    if (this.getContent(\"content_default_value\")) {\r\n      this.dispatchFieldValueToStore(this.getContent(\"content_default_value\"));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Чистит значение\r\n   */\r\n  clearValue() {\r\n    this.onChange(\"\");\r\n    this.dispatchFieldValueToStore(\"\", true);\r\n  }\r\n\r\n  /**\r\n   * Обработка нажатия клавиши\r\n   * @param {{}} e\r\n   */\r\n  handleEnter = e => {\r\n    if (e.keyCode === 13) {\r\n      e.preventDefault();\r\n      const inputs = Array.from(document.querySelectorAll(\"input,select\"));\r\n      const index = inputs.indexOf(e.target);\r\n      if (index === undefined) return;\r\n      inputs[index + 1] && inputs[index + 1].focus();\r\n      const {\r\n        create_allowed,\r\n        create_label,\r\n        create_url\r\n      } = this.props.element.getSettings();\r\n      if (create_allowed && create_label && create_url) {\r\n        this.createItem(e);\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Загрузка виджета\r\n   * @param {{}} prevProps\r\n   * @param {{}} prevState\r\n   */\r\n  async _componentDidMount(prevProps, prevState) {\r\n    if (this.props.element.getSettings(\"content_options\")) {\r\n      let options = parseOptionsFromSettings(\r\n        this.props.element.getSettings(\"content_options\")\r\n      );\r\n\r\n      this.setState(state => ({ ...state, options }));\r\n    }\r\n\r\n    let value = this.state.value;\r\n\r\n    /**\r\n     * Если динамическое значение загрузилось,\r\n     * то используем this.getContent для получение этого динамического значения\r\n     * старые динамические данные\r\n     * */\r\n    if (\r\n      _.get(value, \"dynamic\") &&\r\n      this.props.currentModel.getProperty(\"altrpModelUpdated\")\r\n    ) {\r\n      value = this.getContent(\"content_default_value\");\r\n    }\r\n\r\n    /**\r\n     * Если модель обновилась при смене URL\r\n     */\r\n    if (\r\n      prevProps &&\r\n      !prevProps.currentModel.getProperty(\"altrpModelUpdated\") &&\r\n      this.props.currentModel.getProperty(\"altrpModelUpdated\")\r\n    ) {\r\n      value = this.getContent(\"content_default_value\");\r\n      this.setState(\r\n        state => ({ ...state, value, contentLoaded: true }),\r\n        () => {\r\n          this.dispatchFieldValueToStore(value);\r\n        }\r\n      );\r\n      return;\r\n    }\r\n\r\n    if (\r\n      this.props.currentModel.getProperty(\"altrpModelUpdated\") &&\r\n      this.props.currentDataStorage.getProperty(\"currentDataStorageLoaded\") &&\r\n      !this.state.contentLoaded\r\n    ) {\r\n      value = this.getContent(\"content_default_value\");\r\n      this.setState(\r\n        state => ({ ...state, value, contentLoaded: true }),\r\n        () => {\r\n          this.dispatchFieldValueToStore(value);\r\n        }\r\n      );\r\n      return;\r\n    }\r\n\r\n    if (this.state.value !== value) {\r\n      this.setState(\r\n        state => ({ ...state, value }),\r\n        () => {\r\n          this.dispatchFieldValueToStore(value);\r\n        }\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Получить url для запросов\r\n   */\r\n  getRoute() {\r\n    let url = this.props.element.getSettings(\"model_for_options\");\r\n\r\n    if (url.indexOf(\"/\") === -1) {\r\n      return `/ajax/models/${url}_options`;\r\n    }\r\n    if (url.indexOf(\"{{\") !== -1) {\r\n      url = replaceContentWithData(url);\r\n    }\r\n    return url;\r\n  }\r\n\r\n  /**\r\n   * Обновление виджета\r\n   */\r\n  async _componentDidUpdate(prevProps, prevState) {\r\n    const { content_options, model_for_options } = this.state.settings;\r\n\r\n    if (\r\n      prevProps &&\r\n      !prevProps.currentDataStorage.getProperty(\"currentDataStorageLoaded\") &&\r\n      this.props.currentDataStorage.getProperty(\"currentDataStorageLoaded\")\r\n    ) {\r\n      let value = this.getContent(\r\n        \"content_default_value\",\r\n        this.props.element.getSettings(\"select2_multiple\")\r\n      );\r\n      this.setState(\r\n        state => ({ ...state, value, contentLoaded: true }),\r\n        () => {\r\n          this.dispatchFieldValueToStore(value);\r\n        }\r\n      );\r\n    }\r\n\r\n    /**\r\n     * Если обновилась модель, то пробрасываем в стор новое значение (старый источник диамических данных)\r\n     */\r\n    if (\r\n      !_.isEqual(this.props.currentModel, prevProps.currentModel) &&\r\n      this.state.value &&\r\n      this.state.value.dynamic\r\n    ) {\r\n      this.dispatchFieldValueToStore(this.getContent(\"content_default_value\"));\r\n    }\r\n\r\n    /**\r\n     * Если обновилось хранилище данных формы, currentDataStorage или модель, то получаем новые опции c сервера\r\n     */\r\n    if (\r\n      this.props.formsStore !== prevProps.formsStore ||\r\n      this.props.currentModel !== prevProps.currentModel ||\r\n      this.props.currentDataStorage !== prevProps.currentDataStorage\r\n    ) {\r\n      this.updateOptions();\r\n    }\r\n    if (content_options && !model_for_options) {\r\n      let options = parseOptionsFromSettings(content_options);\r\n      if (!_.isEqual(options, this.state.options)) {\r\n        this.setState(state => ({ ...state, options }));\r\n      }\r\n    }\r\n    this.updateValue(prevProps);\r\n  }\r\n\r\n  /**\r\n   * Обновить значение если нужно\r\n   * @param {{}} prevProps\r\n   */\r\n  updateValue(prevProps) {\r\n\r\n    if (isEditor()) {\r\n      return;\r\n    }\r\n\r\n    let content_calculation = this.props.element.getSettings(\r\n      \"content_calculation\"\r\n    );\r\n    const altrpforms = this.props.formsStore;\r\n    const fieldName = this.props.element.getFieldId();\r\n    const formId = this.props.element.getFormId();\r\n\r\n    if (!content_calculation) {\r\n      /**\r\n       * Обновить значение, если formsStore изменилось из другого компонента\r\n       */\r\n      const path = `${formId}.${fieldName}`;\r\n      if (\r\n        this.props.formsStore !== prevProps.formsStore &&\r\n        _.get(altrpforms, path) !== this.state.value\r\n      ) {\r\n        this.setState(state => ({\r\n          ...state,\r\n          value: _.get(altrpforms, path)\r\n        }));\r\n      }\r\n      return;\r\n    }\r\n\r\n    const prevContext = {};\r\n    const altrpdata = this.props.currentDataStorage.getData();\r\n    const altrpmodel = this.props.currentModel.getData();\r\n    const altrpuser = this.props.currentUser.getData();\r\n    const altrppagestate = this.props.altrpPageState.getData();\r\n    const altrpresponses = this.props.altrpresponses.getData();\r\n    const altrpmeta = this.props.altrpMeta.getData();\r\n    const context = this.props.element.getCurrentModel().getData();\r\n\r\n    if (content_calculation.indexOf(\"altrpdata\") !== -1) {\r\n      context.altrpdata = altrpdata;\r\n      if (!altrpdata.currentDataStorageLoaded) {\r\n        prevContext.altrpdata = altrpdata;\r\n      } else {\r\n        prevContext.altrpdata = prevProps.currentDataStorage.getData();\r\n      }\r\n    }\r\n\r\n    if (content_calculation.indexOf(\"altrpforms\") !== -1) {\r\n      context.altrpforms = altrpforms;\r\n      /**\r\n       * Не производим вычисления, если изменилось текущее поле\r\n       */\r\n      if (`${formId}.${fieldName}` === altrpforms.changedField) {\r\n        prevContext.altrpforms = altrpforms;\r\n      } else {\r\n        prevContext.altrpforms = prevProps.formsStore;\r\n      }\r\n    }\r\n\r\n    if (content_calculation.indexOf(\"altrpmodel\") !== -1) {\r\n      context.altrpmodel = altrpmodel;\r\n      prevContext.altrpmodel = prevProps.currentModel.getData();\r\n    }\r\n\r\n    if (content_calculation.indexOf(\"altrpuser\") !== -1) {\r\n      context.altrpuser = altrpuser;\r\n      prevContext.altrpuser = prevProps.currentUser.getData();\r\n    }\r\n\r\n    if (content_calculation.indexOf(\"altrpuser\") !== -1) {\r\n      context.altrpuser = altrpuser;\r\n      prevContext.altrpuser = prevProps.currentUser.getData();\r\n    }\r\n\r\n    if (content_calculation.indexOf(\"altrppagestate\") !== -1) {\r\n      context.altrppagestate = altrppagestate;\r\n      prevContext.altrppagestate = prevProps.altrpPageState.getData();\r\n    }\r\n\r\n    if (content_calculation.indexOf(\"altrpmeta\") !== -1) {\r\n      context.altrpmeta = altrpmeta;\r\n      prevContext.altrpmeta = prevProps.altrpMeta.getData();\r\n    }\r\n\r\n    if (content_calculation.indexOf(\"altrpresponses\") !== -1) {\r\n      context.altrpresponses = altrpresponses;\r\n      prevContext.altrpresponses = prevProps.altrpresponses.getData();\r\n    }\r\n\r\n    if (content_calculation.indexOf(\"altrpstorage\") !== -1) {\r\n      context.altrpstorage = getDataFromLocalStorage(\"altrpstorage\", {});\r\n    }\r\n\r\n    if (\r\n      _.isEqual(prevProps.currentDataStorage, this.props.currentDataStorage) &&\r\n      _.isEqual(prevProps.currentUser, this.props.currentUser) &&\r\n      _.isEqual(prevProps.formsStore, this.props.formsStore) &&\r\n      _.isEqual(prevProps.altrpPageState, this.props.altrpPageState) &&\r\n      _.isEqual(prevProps.altrpMeta, this.props.altrpMeta) &&\r\n      _.isEqual(prevProps.altrpresponses, this.props.altrpresponses) &&\r\n      _.isEqual(prevProps.currentModel, this.props.currentModel)\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    if (\r\n      !_.isEqual(prevProps.formsStore, this.props.formsStore) &&\r\n      `${formId}.${fieldName}` === altrpforms.changedField\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    let value = \"\";\r\n\r\n    try {\r\n      content_calculation = content_calculation\r\n        .replace(/}}/g, \"')\")\r\n        .replace(/{{/g, \"_.get(context, '\");\r\n      value = eval(content_calculation);\r\n      if (value === this.state.value) {\r\n        return;\r\n      }\r\n      this.setState(\r\n        state => ({ ...state, value }),\r\n        () => {\r\n          this.dispatchFieldValueToStore(value);\r\n        }\r\n      );\r\n    } catch (e) {\r\n      console.error(\r\n        \"Evaluate error in Input \" + e.message,\r\n        this.props.element.getId()\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Обновляет опции для селекта при обновлении данных, полей формы\r\n   */\r\n  async updateOptions() {\r\n    {\r\n      let formId = this.props.element.getFormId();\r\n      let paramsForUpdate = this.props.element.getSettings(\"params_for_update\");\r\n      let formData = _.get(this.props.formsStore, [formId], {});\r\n      paramsForUpdate = parseParamsFromString(\r\n        paramsForUpdate,\r\n        new AltrpModel(formData)\r\n      );\r\n      /**\r\n       * Сохраняем параметры запроса, и если надо обновляем опции\r\n       */\r\n      let options = [...this.state.options];\r\n\r\n      if (!_.isEqual(paramsForUpdate, this.state.paramsForUpdate)) {\r\n        if (!_.isEmpty(paramsForUpdate)) {\r\n          if (this.props.element.getSettings(\"params_as_filters\", false)) {\r\n            paramsForUpdate = JSON.stringify(paramsForUpdate);\r\n            options = await new Resource({\r\n              route: this.getRoute()\r\n            }).getQueried({ filters: paramsForUpdate });\r\n          } else {\r\n            options = await new Resource({ route: this.getRoute() }).getQueried(\r\n              paramsForUpdate\r\n            );\r\n          }\r\n          options = !_.isArray(options) ? options.data : options;\r\n          options = _.isArray(options) ? options : [];\r\n        } else if (this.state.paramsForUpdate) {\r\n          options = await new Resource({ route: this.getRoute() }).getAll();\r\n          options = !_.isArray(options) ? options.data : options;\r\n          options = _.isArray(options) ? options : [];\r\n        }\r\n\r\n        this.setState(state => ({\r\n          ...state,\r\n          paramsForUpdate,\r\n          options\r\n        }));\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Изменение значения в виджете\r\n   * @param e\r\n   * @param  editor для получения изменений из CKEditor\r\n   */\r\n  onChange(e, editor = null) {\r\n    let value = \"\";\r\n    let valueToDispatch;\r\n\r\n    if (e && e.target) {\r\n      value = e.target.value;\r\n    }\r\n\r\n    if (e && e.value) {\r\n      value = e.value;\r\n    }\r\n\r\n    if (_.get(editor, \"getData\")) {\r\n      value = `<div class=\"ck ck-content\" style=\"width:100%\">${editor.getData()}</div>`;\r\n    }\r\n\r\n    if (_.isArray(e)) {\r\n      value = _.cloneDeep(e);\r\n    }\r\n\r\n    if (\r\n      this.props.element.getSettings(\"content_options_nullable\") &&\r\n      e &&\r\n      e.value === \"<null>\"\r\n    ) {\r\n      value = null;\r\n    }\r\n\r\n    this.setState(\r\n      state => ({\r\n        ...state,\r\n        value\r\n      }),\r\n      () => {\r\n        /**\r\n         * Обновляем хранилище только если не текстовое поле\r\n         */\r\n\r\n        const change_actions = this.props.element.getSettings(\"change_actions\");\r\n        const change_change_end = this.props.element.getSettings(\r\n          \"change_change_end\"\r\n        );\r\n        const change_change_end_delay = this.props.element.getSettings(\r\n          \"change_change_end_delay\"\r\n        );\r\n\r\n        if (change_actions && !change_change_end && !isEditor()) {\r\n          this.debounceDispatch(\r\n            valueToDispatch !== undefined ? valueToDispatch : value\r\n          );\r\n        }\r\n        if (change_actions && change_change_end && !isEditor()) {\r\n          this.timeInput && clearTimeout(this.timeInput);\r\n          this.timeInput = setTimeout(() => {\r\n            this.debounceDispatch(\r\n              valueToDispatch !== undefined ? valueToDispatch : value\r\n            );\r\n          }, change_change_end_delay);\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  debounceDispatch = _.debounce(\r\n    value => this.dispatchFieldValueToStore(value, true),\r\n    150\r\n  );\r\n\r\n  /**\r\n   * получить опции\r\n   */\r\n  getOptions() {\r\n    let options = [...this.state.options];\r\n    const optionsDynamicSetting = this.props.element.getDynamicSetting(\r\n      \"content_options\"\r\n    );\r\n\r\n    if (optionsDynamicSetting) {\r\n      options = convertData(optionsDynamicSetting, options);\r\n    }\r\n\r\n    if (!this.props.element.getSettings(\"sort_default\")) {\r\n      options = _.sortBy(options, o => o && (o.label ? o.label.toString() : o));\r\n    }\r\n\r\n    return options;\r\n  }\r\n\r\n  /**\r\n   * Передадим значение в хранилище формы\r\n   * @param {*} value\r\n   * @param {boolean} userInput true - имзенилось пользователем\r\n   */\r\n  dispatchFieldValueToStore = async (value, userInput = false) => {\r\n    let formId = this.props.element.getFormId();\r\n    let fieldName = this.props.element.getFieldId();\r\n\r\n    if (fieldName.indexOf(\"{{\") !== -1) {\r\n      fieldName = replaceContentWithData(fieldName);\r\n    }\r\n\r\n    if (_.isObject(this.props.appStore) && fieldName && formId) {\r\n      this.props.appStore.dispatch(\r\n        changeFormFieldValue(fieldName, value, formId, userInput)\r\n      );\r\n\r\n      if (userInput) {\r\n        const change_actions = this.props.element.getSettings(\"change_actions\");\r\n\r\n        if (change_actions && !isEditor()) {\r\n          const actionsManager = (\r\n            await import(\r\n              /* webpackChunkName: 'ActionsManager' */\r\n              \"../../../../../front-app/src/js/classes/modules/ActionsManager.js\"\r\n            )\r\n          ).default;\r\n          await actionsManager.callAllWidgetActions(\r\n            this.props.element.getIdForAction(),\r\n            \"change\",\r\n            change_actions,\r\n            this.props.element\r\n          );\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n\r\n  /**\r\n   * Взовращает имя для атрибута name\r\n   * @return {string}\r\n   */\r\n  getName() {\r\n    return `${this.props.element.getFormId()}[${this.props.element.getFieldId()}]`;\r\n  }\r\n  /**\r\n   *\r\n   * @returns {*}\r\n   */\r\n  getValue = () => {\r\n    let value;\r\n    let formId = this.props.element.getFormId();\r\n    let fieldName = this.props.element.getFieldId();\r\n    if (isEditor()) {\r\n      value = this.state.value;\r\n    } else {\r\n      value = _.get(appStore.getState(), `formsStore.${formId}.${fieldName}`, '')\r\n    }\r\n    return value;\r\n  }\r\n\r\n  render() {\r\n    if(isEditor()){\r\n      return <FromIcon/>\r\n    }\r\n    let value = this.getValue()\r\n    return <input value={value}\r\n                  type=\"hidden\"\r\n                  name={this.getName()}\r\n                  id={this.getName()}/>\r\n  }\r\n}\r\n\r\nexport default InputHiddenWidget;\r\n"],"sourceRoot":""}