(self.webpackChunk=self.webpackChunk||[]).push([[1999,227],{50676:function(t,e,r){"use strict";function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}r.d(e,{Z:function(){return n}})},59968:function(t,e,r){"use strict";function n(t){if(Array.isArray(t))return t}r.d(e,{Z:function(){return n}})},63349:function(t,e,r){"use strict";function n(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}r.d(e,{Z:function(){return n}})},6610:function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}r.d(e,{Z:function(){return n}})},5991:function(t,e,r){"use strict";function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}r.d(e,{Z:function(){return o}})},96156:function(t,e,r){"use strict";function n(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}r.d(e,{Z:function(){return n}})},66213:function(t,e,r){"use strict";r.d(e,{Z:function(){return o}});var n=r(77608);function o(t,e,r){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=(0,n.Z)(t)););return t}(t,e);if(o){var a=Object.getOwnPropertyDescriptor(o,e);return a.get?a.get.call(r):a.value}})(t,e,r||t)}},77608:function(t,e,r){"use strict";function n(t){return(n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}r.d(e,{Z:function(){return n}})},10379:function(t,e,r){"use strict";r.d(e,{Z:function(){return o}});var n=r(14665);function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&(0,n.Z)(t,e)}},96410:function(t,e,r){"use strict";function n(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}r.d(e,{Z:function(){return n}})},28970:function(t,e,r){"use strict";function n(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}r.d(e,{Z:function(){return n}})},46070:function(t,e,r){"use strict";r.d(e,{Z:function(){return a}});var n=r(90484),o=r(63349);function a(t,e){return!e||"object"!==(0,n.Z)(e)&&"function"!=typeof e?(0,o.Z)(t):e}},28481:function(t,e,r){"use strict";r.d(e,{Z:function(){return u}});var n=r(59968),o=r(82961),a=r(28970);function u(t,e){return(0,n.Z)(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,a=[],u=!0,i=!1;try{for(r=r.call(t);!(u=(n=r.next()).done)&&(a.push(n.value),!e||a.length!==e);u=!0);}catch(t){i=!0,o=t}finally{try{u||null==r.return||r.return()}finally{if(i)throw o}}return a}}(t,e)||(0,o.Z)(t,e)||(0,a.Z)()}},99809:function(t,e,r){"use strict";r.d(e,{Z:function(){return i}});var n=r(59968),o=r(96410),a=r(82961),u=r(28970);function i(t){return(0,n.Z)(t)||(0,o.Z)(t)||(0,a.Z)(t)||(0,u.Z)()}},85061:function(t,e,r){"use strict";r.d(e,{Z:function(){return u}});var n=r(50676),o=r(96410),a=r(82961);function u(t){return function(t){if(Array.isArray(t))return(0,n.Z)(t)}(t)||(0,o.Z)(t)||(0,a.Z)(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},90484:function(t,e,r){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}r.d(e,{Z:function(){return n}})},82961:function(t,e,r){"use strict";r.d(e,{Z:function(){return o}});var n=r(50676);function o(t,e){if(t){if("string"==typeof t)return(0,n.Z)(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?(0,n.Z)(t,e):void 0}}},69705:function(t,e,r){"use strict";r.r(e);var n=r(92137),o=r(6610),a=r(5991),u=r(10379),i=r(46070),c=r(77608),s=r(87757),f=r.n(s),p=r(26553),l=r(46221),d=r(32869);function y(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return g(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=!0,i=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return u=t.done,t},e:function(t){i=!0,a=t},f:function(){try{u||null==r.return||r.return()}finally{if(i)throw a}}}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var m=window.altrpHelpers,b=m.Resource,h=m.isJSON,v=m.mbParseJSON,S=m.replaceContentWithData,w=function(t){(0,u.Z)(w,t);var e,r,s,g,m=(s=w,g=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=(0,c.Z)(s);if(g){var r=(0,c.Z)(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return(0,i.Z)(this,t)});function w(t){var e;return(0,o.Z)(this,w),(e=m.call(this,t)).onStoreUpdate=(0,n.Z)(f().mark((function t(){var r;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=appStore.getState().formsStore,_.isEqual(e.getProperty("formsStore"),r)||!e.getProperty("updated")){t.next=5;break}return e.setProperty("formsStore",r),t.next=5,e.onFormsUpdate();case 5:case"end":return t.stop()}}),t)}))),e.setProperty("dataSourcesFormsDependent",[]),e.setProperty("formsStore",appStore.getState().formsStore),appStore.subscribe(e.onStoreUpdate),e}return(0,a.Z)(w,[{key:"updateCurrent",value:(r=(0,n.Z)(f().mark((function t(){var e,r,o,a,u,i,c=this,s=arguments;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=s.length>0&&void 0!==s[0]?s[0]:null,r=!(s.length>1&&void 0!==s[1])||s[1],e=e.map((function(t){return t instanceof d.Z?t:new d.Z(t)})),!appStore.getState().currentUser.isEmpty()){t.next=9;break}return t.next=6,new b({route:"/ajax/current-user"}).getAll();case 6:o=(o=t.sent).data,appStore.dispatch((0,l.a2)(o));case 9:r||_.get(e,"length")||(e=this.getProperty("currentDataSources")),e||(e=[]),r&&(this.setProperty("currentDataSources",e),this.setProperty("updated",!1),e=e.filter((function(t){return t.getProperty("autoload")}))),e=e.filter((function(t){var e=t.getProperty("parameters");return!h(e)||!((e=v(e,[]))&&e.find((function(e){if(-1===e.paramValue.toString().indexOf("altrpforms."))return!1;var n=t.getParams(window.currentRouterMatch.data.params,"altrpforms.");if(r&&c.subscribeToFormsUpdate(t,n),!e.required)return!1;var o=e.paramValue||"";return-1!==o.indexOf("{{")&&(o=S(o)),!o})))})),a={},e.forEach((function(t){a[t.getProperty("priority")]=a[t.getProperty("priority")]||[],a[t.getProperty("priority")].push(t)})),r&&appStore.dispatch((0,p.PL)()),t.t0=f().keys(a);case 17:if((t.t1=t.t0()).done){t.next=31;break}if(u=t.t1.value,a.hasOwnProperty(u)){t.next=21;break}return t.abrupt("continue",17);case 21:return r&&appStore.dispatch((0,p.PL)()),i=a[u].map(function(){var t=(0,n.Z)(f().mark((function t(n){var o,a,u,i,s,l;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.getWebUrl()){t.next=46;break}if(o=n.getParams(window.currentRouterMatch.params,"altrpforms."),a=_.cloneDeep(o),u=!1,_.each(o,(function(t,e){0===t.toString().indexOf("altrpforms.")&&(o[e]=_.get(appStore.getState().formsStore,t.toString().replace("altrpforms.",""),""),u=!0)})),u&&r&&c.subscribeToFormsUpdate(n,_.cloneDeep(a)),i={},t.prev=7,!(s=_.get(window.altrpPreloadedDatasources,n.getAlias()))){t.next=14;break}i=s,_.unset(window.altrpPreloadedDatasources,n.getAlias()),t.next=32;break;case 14:if("show"!==n.getType()){t.next=22;break}if(!(l=_.get(o,"id",_.get(c.props,"match.params.id")))){t.next=20;break}return t.next=19,new b({route:n.getWebUrl()}).get(l);case 19:i=t.sent;case 20:t.next=32;break;case 22:if(_.isEmpty(o)){t.next=29;break}return t.next=25,new b({route:n.getWebUrl()}).getQueried(o);case 25:i=t.sent,n.params=_.cloneDeep(o),t.next=32;break;case 29:return t.next=31,new b({route:n.getWebUrl()}).getAll();case 31:i=t.sent;case 32:t.next=41;break;case 34:if(t.prev=34,t.t0=t.catch(7),!(t.t0 instanceof Promise)){t.next=40;break}return t.next=39,t.t0.then();case 39:t.t0=t.sent;case 40:console.error(t.t0);case 41:return i=_.get(i,"data",i),(e=e.filter((function(t){return t!==n}))).length||c.setProperty("updated",!0),appStore.dispatch((0,p.cC)(n.getAlias(),i)),t.abrupt("return",i);case 46:case"end":return t.stop()}}),t,null,[[7,34]])})));return function(e){return t.apply(this,arguments)}}()),console.log("Update Datasource Start: ",performance.now()),t.next=26,Promise.all(i);case 26:t.sent,console.log("Update Datasource End: ",performance.now()),r&&appStore.dispatch((0,p.vt)()),t.next=17;break;case 31:e.length||appStore.dispatch((0,p.vt)());case 32:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"clearCurrent",value:function(){this.unsetProperty("currentDataSources"),this.setProperty("dataSourcesFormsDependent",[]),appStore.dispatch((0,p.qS)())}},{key:"subscribeToFormsUpdate",value:function(t,e){var r=this.getProperty("dataSourcesFormsDependent");-1===_.findIndex(r,(function(e){return e.dataSource===t}))&&r.push({dataSource:t,params:e})}},{key:"onFormsUpdate",value:(e=(0,n.Z)(f().mark((function t(){var e,r,n,o,a;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=(e=this.getProperty("dataSourcesFormsDependent",[])).filter((function(t){var e=t.dataSource.getProperty("parameters");return!h(e)||!(e=v(e,[])).find((function(t){if(!t.required)return!1;var e=t.paramValue||"";return-1!==e.indexOf("{{")&&(e=S(e)),!e}))})),e=_.sortBy(e,(function(t){return t.priority})),r=appStore.getState().formsStore,n=y(e),t.prev=5,a=f().mark((function t(){var e,n,a,u,i,c;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=o.value,n=e.dataSource,a=e.updating,u=_.cloneDeep(n.params),i=n.getParams(window.currentRouterMatch.params,"altrpforms."),_.forEach(i,(function(t,e){0===t.toString().indexOf("altrpforms.")&&(i[e]=_.get(r,t.replace("altrpforms.","")))})),_.isEqual(i,u)||a){t.next=52;break}return n.params=_.cloneDeep(i),e.updating=!0,c={},t.prev=10,t.next=13,new b({route:n.getWebUrl()}).getQueried(i);case 13:c=t.sent,c=_.get(c,"data",c),appStore.dispatch((0,p.cC)(n.getAlias(),c)),t.next=26;break;case 18:if(t.prev=18,t.t0=t.catch(10),!(t.t0 instanceof Promise)){t.next=25;break}return t.next=23,t.t0.then();case 23:t.t0=t.sent,t.t0=v(t.t0);case 25:console.error(t.t0);case 26:if(t.prev=26,void 0===e.pendingParameters||_.isEqual(e.pendingParameters,i)){t.next=48;break}return t.prev=28,t.next=31,new b({route:n.getWebUrl()}).getQueried(e.pendingParameters);case 31:c=t.sent,c=_.get(c,"data",c),appStore.dispatch((0,p.cC)(n.getAlias(),c)),n.params=_.cloneDeep(e.pendingParameters),t.next=45;break;case 37:if(t.prev=37,t.t1=t.catch(28),!(t.t1 instanceof Promise)){t.next=44;break}return t.next=42,t.t1.then();case 42:t.t1=t.sent,t.t1=v(t.t1);case 44:console.error(t.t1);case 45:return t.prev=45,_.unset(e,"pendingParameters"),t.finish(45);case 48:return e.updating=!1,t.finish(26);case 50:t.next=53;break;case 52:!_.isEqual(i,u)&&a&&(e.pendingParameters=_.cloneDeep(i));case 53:case"end":return t.stop()}}),t,null,[[10,18,26,50],[28,37,45,48]])})),n.s();case 8:if((o=n.n()).done){t.next=12;break}return t.delegateYield(a(),"t0",10);case 10:t.next=8;break;case 12:t.next=17;break;case 14:t.prev=14,t.t1=t.catch(5),n.e(t.t1);case 17:return t.prev=17,n.f(),t.finish(17);case 20:case"end":return t.stop()}}),t,this,[[5,14,17,20]])}))),function(){return e.apply(this,arguments)})}]),w}(AltrpModel);window.dataStorageUpdater=window.dataStorageUpdater||new w,e.default=window.dataStorageUpdater},26553:function(t,e,r){"use strict";r.d(e,{I3:function(){return n},En:function(){return o},Tg:function(){return a},zM:function(){return u},cC:function(){return i},qS:function(){return c},vt:function(){return s},PL:function(){return f}});var n="CHANGE_CURRENT_DATASOURCE",o="CLEAR_CURRENT_DATASOURCE",a="SET_CURRENT_DATASOURCE_LOADED",u="SET_CURRENT_DATASOURCE_LOADING";function i(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{type:n,data:e,dataStorageName:t}}function c(){return{type:o}}function s(){return{type:a}}function f(){return{type:u}}},69852:function(t){function e(t,e,r){e="number"==typeof e?o(e.toString()):"string"==typeof e?o(e):e;const a=(t,e,r,o)=>{let u,i=e[o];return e.length>o?(Array.isArray(t)?(i=n(i,t),u=t.slice()):u=Object.assign({},t),u[i]=a(void 0!==t[i]?t[i]:{},e,r,o+1),u):"function"==typeof r?r(t):r};return a(t,e,r,0)}function r(t,e,r){e="number"==typeof e?o(e.toString()):"string"==typeof e?o(e):e;for(var n=0;n<e.length;n++){if(null===t||"object"!=typeof t)return r;let o=e[n];Array.isArray(t)&&"$end"===o&&(o=t.length-1),t=t[o]}return void 0===t?r:t}function n(t,e){if("$end"===t&&(t=Math.max(e.length-1,0)),!/^\+?\d+$/.test(t))throw new Error(`Array index '${t}' has to be an integer`);return parseInt(t)}function o(t){return t.split(".").reduce(((t,e,r,n)=>{const o=r>0&&n[r-1];if(o&&/(?:^|[^\\])\\$/.test(o)){const r=t.pop();t.push(r.slice(0,-1)+"."+e)}else t.push(e);return t}),[])}t.exports={set:e,get:r,delete:function(t,e){e="number"==typeof e?o(e.toString()):"string"==typeof e?o(e):e;const r=(t,e,o)=>{let a,u=e[o];return null===t||"object"!=typeof t||!Array.isArray(t)&&void 0===t[u]?t:e.length-1>o?(Array.isArray(t)?(u=n(u,t),a=t.slice()):a=Object.assign({},t),a[u]=r(t[u],e,o+1),a):(Array.isArray(t)?(u=n(u,t),a=[].concat(t.slice(0,u),t.slice(u+1))):(a=Object.assign({},t),delete a[u]),a)};return r(t,e,0)},toggle:function(t,n){const o=r(t,n);return e(t,n,!Boolean(o))},merge:function(t,n,o){const a=r(t,n);return"object"==typeof a?Array.isArray(a)?e(t,n,a.concat(o)):e(t,n,null===a?o:Object.assign({},a,o)):void 0===a?e(t,n,o):t}}}}]);
//# sourceMappingURL=DatastorageUpdater.d4c98a56dae124c0a55c.bundle.js.map