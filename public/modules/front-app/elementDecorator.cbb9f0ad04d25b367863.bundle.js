(self.webpackChunk=self.webpackChunk||[]).push([[4358,1198],{71743:function(e,t,n){"use strict";var o=n(6610),r=n(5991),i=n(83465),a=n.n(i),s=n(29208),c=n.n(s),l=n(31468),d=n.n(l),_=n(38394),u=n.n(_),p=n(96633),h=n.n(p),g=n(99245),m=n.n(g),b=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,o.Z)(this,e),this.data=a()(t)}return(0,r.Z)(e,[{key:"getData",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return e?a()(this.data):this.data}},{key:"isEmpty",value:function(){return m()(this.data)}},{key:"getProperty",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return c()(this.data,e,t)}},{key:"hasProperty",value:function(e){return u()(this.data,e)}},{key:"setProperty",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return n instanceof e&&(n=n.getData(!1)),d()(this.data,t,n)}},{key:"unsetProperty",value:function(e){return h()(this.data,e)}}]),e}();window.AltrpModel=b,t.Z=b},75098:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return p}});var o=n(6610),r=n(5991),i=n(96156),a=n(92137),s=n(87757),c=n.n(s),l=n(38773);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}var u=function(){function e(t,n){(0,o.Z)(this,e),this.modelName=t,n||console.error("ид модели не указан!"),this.modelId=n,this.data=null,this.subscribers=[],this.resource=new l.Z({route:"/ajax/models/".concat(this.modelName)}),this.updating=!1}var t;return(0,r.Z)(e,[{key:"subscribeToUpdates",value:function(e){this.subscribers.push(e),this.updating||(this.data&&this.callSubscribers(),this.updateData())}},{key:"updateData",value:(t=(0,a.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updating=!0,e.next=3,this.resource.get(this.modelId);case 3:this.data=e.sent,this.updating=!1,this.callSubscribers();case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"callSubscribers",value:function(){var e=this;this.subscribers.forEach((function(t){_.isFunction(t.updateModelData)&&t.updateModelData(e.getData()),_.isFunction(t)&&t(e.getData())}))}},{key:"unsubscribe",value:function(e){this.subscribers=this.subscribers.filter((function(t){return t!==e}))}},{key:"getData",value:function(){return this.data}},{key:"updateWithData",value:function(e){this.data=_.extend(this.data,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e)),this.callSubscribers()}}]),e}(),p=new(function(){function e(){(0,o.Z)(this,e),this.modelsStorage={}}return(0,r.Z)(e,[{key:"updateModel",value:function(e,t){this.modelsStorage["".concat(e,"::").concat(t)]||this.modelsStorage["".concat(e,"::").concat(t)].updateData()}},{key:"addModel",value:function(e){}},{key:"getModel",value:function(e,t){}},{key:"subscribeToModelUpdates",value:function(e,t,n){return t?(this.modelsStorage["".concat(e,"::").concat(t)]||(this.modelsStorage["".concat(e,"::").concat(t)]=new u(e,t)),(o=this.modelsStorage["".concat(e,"::").concat(t)]).subscribeToUpdates(n),o):null;var o}},{key:"unsubscribe",value:function(e,t,n){return t?this.modelsStorage["".concat(e,"::").concat(t)]?((o=this.modelsStorage["".concat(e,"::").concat(t)]).unsubscribe(n),o):void 0:null;var o}},{key:"updateModelWithData",value:function(e,t,n){this.modelsStorage["".concat(e,"::").concat(t)]&&this.modelsStorage["".concat(e,"::").concat(t)].updateWithData(n)}}]),e}())},42050:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:function(){return frontDecorate}});var _babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(96156),_editor_src_js_classes_modules_ModelsManager__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(75098),_editor_src_js_classes_AltrpModel__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(71743),_store_elements_settings_actions__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(45530);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){(0,_babel_runtime_helpers_defineProperty__WEBPACK_IMPORTED_MODULE_0__.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _window$altrpHelpers=window.altrpHelpers,conditionsChecker=_window$altrpHelpers.conditionsChecker,getConverter=_window$altrpHelpers.getConverter,getDataByPath=_window$altrpHelpers.getDataByPath,isEditor=_window$altrpHelpers.isEditor,prepareContext=_window$altrpHelpers.prepareContext,replaceContentWithData=_window$altrpHelpers.replaceContentWithData;function componentWillUnmount(){var e=this;window.actionsManager&&actionsManager.unregisterWidgetActions(this.props.element.getIdForAction()),this.props.element.dynamicContentSettings&&(this.props.element.dynamicContentSettings.forEach((function(t){var n=e.props.element.getModelsInfoByModelName(t.modelName);n&&!n.relation?_editor_src_js_classes_modules_ModelsManager__WEBPACK_IMPORTED_MODULE_1__.default.unsubscribe(n.modelName,n.modelId||e.getModelId(),e):n&&n.relation})),appStore.dispatch((0,_store_elements_settings_actions__WEBPACK_IMPORTED_MODULE_3__.zZ)(this.props.element.getId(),this.props.element.getName(),{})),_.isFunction(this._componentWillUnmount)&&this._componentWillUnmount())}function updateModelData(e){this.setState((function(t){return _objectSpread(_objectSpread({},t),{},{modelData:e})}))}function subscribeToModels(e){var t=this;this.props.element.dynamicContentSettings&&this.props.element.dynamicContentSettings.forEach((function(n){var o=t.props.element.getModelsInfoByModelName(n.modelName);o&&!o.relation?t.model=_editor_src_js_classes_modules_ModelsManager__WEBPACK_IMPORTED_MODULE_1__.default.subscribeToModelUpdates(o.modelName,o.modelId||e,t):o&&o.relation}))}function getContent(settingName){var returnRaw=arguments.length>1&&void 0!==arguments[1]&&arguments[1],element=this.props.element,content=this.props.element.getSettings(settingName);if(content&&content.dynamic&&this.props.currentModel.getProperty("altrpModelUpdated")){var model=element.hasCardModel()?element.getCardModel():this.props.currentModel;content=model?model.getProperty(content.fieldName):" "}if(!isEditor()){var _model=element.hasCardModel()?element.getCardModel():this.props.currentModel;if("content_default_value"===settingName&&_.isString(content)&&-1!==content.indexOf("{{{")){var context=this.props.element.getCurrentModel().getData();context=prepareContext(context);var replacedContent=content.replace(/}}}/g,"')").replace(/{{{/g,"_.get(context, '");try{return content=eval(replacedContent),_.isNumber(content)&&!_.isNaN(content)&&(content+=""),_.isString(content)&&(content=content.replace(/NaN/g,"")),content||""}catch(e){return console.error("Evaluate error in getContent for input default value"+e.message),""}}else returnRaw?(content=content.trim().replace("{{","").replace("}}",""),content=getDataByPath(content,"",_model)):content=replaceContentWithData(content,_model);var contentDynamicSetting=this.props.element.getDynamicSetting(settingName);if(contentDynamicSetting){var converter=getConverter(contentDynamicSetting);content=converter.convertData(content)}}return content&&content.dynamic&&(content=""),"null"===content?"":content}function componentDidMount(){"function"==typeof this._componentDidMount&&this._componentDidMount()}function componentDidUpdate(e,t){var n=this;this.props.element!==e.element&&this.setState((function(e){return _objectSpread(_objectSpread({},e),{},{children:n.props.element.children})})),_.isFunction(this._componentDidUpdate)&&this._componentDidUpdate(e,t),_.isEqual(this.props.match,e.match)&&e.rootElement===this.props.rootElement||_.isFunction(this._componentDidMount)&&this._componentDidMount(e,t);var o=_.get(this.props,"currentDataStorage",new _editor_src_js_classes_AltrpModel__WEBPACK_IMPORTED_MODULE_2__.Z({})),r=_.get(e,"currentDataStorage",new _editor_src_js_classes_AltrpModel__WEBPACK_IMPORTED_MODULE_2__.Z({}));o.getProperty("currentDataStorageLoaded")&&o.getProperty("currentDataStorageLoaded")!==r.getProperty("currentDataStorageLoaded")&&_.isFunction(this._componentDidMount)&&this._componentDidMount(e,t);var i=_.get(this.props,"currentModel",new _editor_src_js_classes_AltrpModel__WEBPACK_IMPORTED_MODULE_2__.Z({})),a=_.get(e,"currentModel",new _editor_src_js_classes_AltrpModel__WEBPACK_IMPORTED_MODULE_2__.Z({}));i.getProperty("altrpModelUpdated")&&i.getProperty("altrpModelUpdated")!==a.getProperty("altrpModelUpdated")&&_.isFunction(this._componentDidMount)&&this._componentDidMount(e,t)}function getModelId(){var e=null;return this.props.match&&this.props.match.params&&this.props.match.params.id&&(e=this.props.match.params.id),e}function isActive(){if(isEditor())return!1;var e=this.props.element;if(!e.getSettings("active_enable"))return!1;var t=e.getSettings("conditional_active_choose"),n=appStore.getState().currentUser,o=!0;switch(t){case"guest":n.isGuest()||(o=!1);break;case"auth":var r=e.getSettings("conditional_active_roles")||[],i=e.getSettings("conditional_active_permissions")||[];if(!n.hasRoles(r)){o=!1;break}if(!n.hasPermissions(i)){o=!1;break}}if(!e.getSettings("active_conditional_other"))return o;var a=e.getSettings("active_conditions",[]);a=a.map((function(e){return{modelField:e.conditional_model_field,operator:e.conditional_other_operator,value:e.conditional_other_condition_value}}));var s=e.getSettings("active_conditional_other_display"),c=conditionsChecker(a,"AND"===s,this.props.element.getCurrentModel(),!0);return"AND"===s?c&&o:c||o}function isDisabled(){if(isEditor())return!1;var e=this.props.element;if(!e.getSettings("disabled_enable"))return!1;var t=e.getSettings("conditional_disabled_choose"),n=appStore.getState().currentUser,o=!0;switch(t){case"guest":n.isGuest()||(o=!1);break;case"auth":var r=e.getSettings("conditional_disabled_roles")||[],i=e.getSettings("conditional_disabled_permissions")||[];if(!n.hasRoles(r)){o=!1;break}if(!n.hasPermissions(i)){o=!1;break}}if(!e.getSettings("disabled_conditional_other"))return o;var a=e.getSettings("disabled_conditions",[]);a=a.map((function(e){return{modelField:e.conditional_model_field,operator:e.conditional_other_operator,value:e.conditional_other_condition_value}}));var s=e.getSettings("disabled_conditional_other_display"),c=conditionsChecker(a,"AND"===s,this.props.element.getCurrentModel(),!0);return"AND"===s?c&&o:c||o}function frontDecorate(e){e.componentWillUnmount=componentWillUnmount.bind(e),e.subscribeToModels=subscribeToModels.bind(e),e.componentDidMount=componentDidMount.bind(e),e.componentDidUpdate=componentDidUpdate.bind(e),e.getContent=getContent.bind(e),e.getModelId=getModelId.bind(e),e.updateModelData=updateModelData.bind(e),e.isActive=isActive.bind(e),e.isDisabled=isDisabled.bind(e)}}}]);
//# sourceMappingURL=elementDecorator.cbb9f0ad04d25b367863.bundle.js.map