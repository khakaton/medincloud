(self.webpackChunk=self.webpackChunk||[]).push([[1170],{71743:function(e,t,o){"use strict";var l=o(6610),a=o(5991),i=o(83465),r=o.n(i),n=o(29208),u=o.n(n),d=o(31468),c=o.n(d),s=o(38394),v=o.n(s),h=o(96633),k=o.n(h),m=o(99245),p=o.n(m),g=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,l.Z)(this,e),this.data=r()(t)}return(0,a.Z)(e,[{key:"getData",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return e?r()(this.data):this.data}},{key:"isEmpty",value:function(){return p()(this.data)}},{key:"getProperty",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return u()(this.data,e,t)}},{key:"hasProperty",value:function(e){return v()(this.data,e)}},{key:"setProperty",value:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return o instanceof e&&(o=o.getData(!1)),c()(this.data,t,o)}},{key:"unsetProperty",value:function(e){return k()(this.data,e)}}]),e}();window.AltrpModel=g,t.Z=g},56269:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return L}});var l=o(85061),a=o(96156),i=o(67294),r=o(86817),n=o(14494),u=o(28481),d=o(87757),c=o.n(d),s=o(65056),v=o(5367),h=o(23233),k=o(58965),m=o(10895),p=o(22683),g=_.find(h.Z,{value:"regagro"}).colors,y=_.find(h.Z,{value:"milk"}).colors,b=_.find(h.Z,{value:"milk2"}).colors,f=p.Z,x=function(e){var t=e.widget,o=e.width,l=void 0===o?300:o,r=e.height,n=void 0===r?450:r,d=e.margin,h=e.dataSource,p=void 0===h?[]:h,x=e.groupMode,M=void 0===x?"stacked":x,C=e.layout,S=void 0===C?"vertical":C,w=e.colorScheme,D=void 0===w?"regagro":w,Z=e.reverse,P=void 0!==Z&&Z,L=e.enableLabel,R=void 0!==L&&L,Y=e.padding,E=void 0===Y?.1:Y,G=e.innerPadding,A=void 0===G?0:G,V=e.borderRadius,W=void 0===V?0:V,z=e.borderWidth,B=void 0===z?0:z,T=e.sort,O=void 0===T?"":T,X=e.tickRotation,I=void 0===X?0:X,q=(e.bottomAxis,e.enableGridX),H=void 0===q||q,N=e.enableGridY,F=void 0===N||N,j=e.customColorSchemeChecker,J=void 0!==j&&j,K=e.customColors,Q=void 0===K?[]:K,U=(e.yScaleMax,e.widgetID),$=e.useCustomTooltips,ee=(0,i.useState)(!1),te=(0,u.Z)(ee,2),oe=te[0],le=te[1],ae=(0,i.useState)([]),ie=(0,u.Z)(ae,2),re=ie[0],ne=ie[1],ue=(0,i.useCallback)((function(){return e=void 0,o=void 0,l=void 0,i=c().mark((function e(){var o,l;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(le(!0),0!=p.length){e.next=8;break}return e.next=4,(0,m.O)(t.source,t.filter);case 4:200===(o=e.sent).status&&(l=o.data.data.map((function(e,t){var o;return o={},(0,a.Z)(o,e.key,Number(e.data)),(0,a.Z)(o,"key",e.key),(0,a.Z)(o,"value",Number(e.data)),o})),ne(l||[]),le(!1)),e.next=20;break;case 8:if(null==O||void 0===p){e.next=18;break}e.t0=O,e.next="value"===e.t0?12:"key"===e.t0?14:16;break;case 12:return p=_.sortBy(p,["value"]),e.abrupt("break",18);case 14:return p=_.sortBy(p,["key"]),e.abrupt("break",18);case 16:return p=p,e.abrupt("break",18);case 18:ne(p||[]),le(!1);case 20:case"end":return e.stop()}}),e)})),new(l||(l=Promise))((function(t,a){function r(e){try{u(i.next(e))}catch(e){a(e)}}function n(e){try{u(i.throw(e))}catch(e){a(e)}}function u(e){var o;e.done?t(e.value):(o=e.value,o instanceof l?o:new l((function(e){e(o)}))).then(r,n)}u((i=i.apply(e,o||[])).next())}));var e,o,l,i}),[t]);return(0,i.useEffect)((function(){ue()}),[re]),oe?i.createElement(s.Z,null):0===re.length?i.createElement(v.Z,null):i.createElement(i.Fragment,null,i.createElement("div",{style:{height:"".concat(n),width:"".concat(l)}},i.createElement(k.jM,{data:re,margin:{top:(null==d?void 0:d.top)||30,right:(null==d?void 0:d.right)||30,bottom:(null==d?void 0:d.bottom)||30,left:(null==d?void 0:d.left)||30},indexBy:"key",colors:J&&Q.length>0?Q:"regagro"===D?g:"milk"===D?y:"milk2"===D?b:{scheme:D},layout:S,tooltip:function(e){return i.createElement(f,{enable:$,datum:e,widgetID:U})},enableGridX:H,enableGridY:F,enableLabel:R,reverse:P,groupMode:M,padding:E,innerPadding:A,borderRadius:W,borderWidth:B,axisBottom:{tickSize:5,tickPadding:5,tickRotation:I,legendOffset:32}})))},M=o(78478),C=o(26568),S=o(53723),w=o(57167),D=o(64367),Z=o(76593),P=(o(47249),window.altrpHelpers.moment),L=(0,n.connect)((function(e){return{currentDataStorage:e.currentDataStorage}}))((function(e){var t,o,u,d,c,s,v,k,m,p,g,y,b,f,L,R,Y,E,G,A,V,W,z=e.settings,B=e.id,T=(0,n.useDispatch)(),O=null==z?void 0:z.margin,X=(null==z?void 0:z.widget_name)||B,I=null==z?void 0:z.isCustomColor,q=null==z||null===(t=z.customScheme)||void 0===t?void 0:t.map((function(e){return _.get(e,"color.colorPickedHex")})),H=null==z?void 0:z.yScaleMax,N=null==z?void 0:z.axisY,F=null==z||null===(o=z.repTooltips)||void 0===o?void 0:o.map((function(e){var t;return{label:_.get(e,"label"),field:_.get(e,"value"),color:null===(t=_.get(e,"color"))||void 0===t?void 0:t.colorPickedHex}})),j=null==z?void 0:z.customTooltip,J=(null==N?void 0:N.map((function(e){var t=(0,Z.getDataByPath)(e.yMarkerValue);return{axis:"y",value:Number(null!==t?t:e.yMarkerValue),lineStyle:{stroke:null!=e.yMarkerColor?e.yMarkerColor.colorPickedHex:"#000000",strokeWidth:e.yMarkerWidth},textStyle:{fill:null!=e.yMarkerLabelColor?e.yMarkerLabelColor.colorPickedHex:"#000000"},legend:e.yMarkerLabel,legendOrientation:e.yMarkerOrientation}})))||[],K=null==z?void 0:z.axisX,Q=(null==K?void 0:K.map((function(e){var t=(0,Z.getDataByPath)(e.xMarkerValue);return{axis:"x",value:null!==t?t:e.xMarkerIsDate?P(e.xMarkerValue).format("DD.MM.YYYY"):e.xMarkerValue,lineStyle:{stroke:null!=e.xMarkerColor?e.xMarkerColor.colorPickedHex:"#000000",strokeWidth:e.xMarkerWidth},textStyle:{fill:null!=e.xMarkerLabelColor?e.xMarkerLabelColor.colorPickedHex:"#000000"},legend:e.xMarkerLabel,legendOrientation:e.xMarkerOrientation}})))||[],U=[];Q.length>0&&(U.push(Q),U=U.flat()),J.length>0&&(U.push(J),U=U.flat());var $,ee,te=null===(u=z.query)||void 0===u||null===(d=u.dataSource)||void 0===d?void 0:d.value,oe=z.isMultiple,le=z.isCustomColors,ae=z.key_is_date,ie=null==z?void 0:z.sort,re=null==z?void 0:z.tickRotation,ne=null==z?void 0:z.bottomAxis,ue=null==z?void 0:z.enableGridX,de=null==z?void 0:z.enableGridY,ce=(null==z?void 0:z.xScaleType)||"point",se=(null==z?void 0:z.precision)||"month",ve=(null==z?void 0:z.curve)||"line",he=null==z?void 0:z.lineWidth,ke=null==z?void 0:z.colorScheme,me=null==z?void 0:z.enableArea,pe=null==z?void 0:z.enablePoints,ge=null==z?void 0:z.pointSize,ye=null==z?void 0:z.pointColor,be=null==z?void 0:z.yMarker,fe=null==z?void 0:z.yMarkerValue,xe=null==z?void 0:z.yMarkerOrientation,Me=null==z?void 0:z.yMarkerColor,Ce=null==z?void 0:z.yMarkerWidth,Se=null==z?void 0:z.yMarkerLabel,we=null==z?void 0:z.yMarkerLabelColor,_e=null==z?void 0:z.xMarker,De=ae?P(null==z?void 0:z.xMarkerValueDate).toDate():null==z?void 0:z.xMarkerValue,Ze=null==z?void 0:z.xMarkerOrientation,Pe=null==z?void 0:z.xMarkerColor,Le=null==z?void 0:z.xMarkerWidth,Re=null==z?void 0:z.xMarkerLabel,Ye=null==z?void 0:z.xMarkerLabelColor,Ee=null==z?void 0:z.layout,Ge=null==z?void 0:z.groupMode,Ae=null==z?void 0:z.reverse,Ve=null==z?void 0:z.borderRadius,We=null==z?void 0:z.borderWidth,ze=null==z?void 0:z.enableLabel,Be=null==z?void 0:z.padding,Te=null==z?void 0:z.innerRadius,Oe=null==z?void 0:z.enableSliceLabels,Xe=null==z?void 0:z.padAngle,Ie=null==z?void 0:z.cornerRadius,qe=null==z?void 0:z.sortByValue,He=null==z?void 0:z.enableRadialLabels,Ne=[],Fe=function(e,t){return e.map((function(e,o){var l=_.get(e,t.key),i=P(l).isValid()?P(l).format("DD.MM.YYYY"):l,r=void 0!==F?null==F?void 0:F.map((function(t){return{label:null==t?void 0:t.label,value:_.get(e,t.field),color:null==t?void 0:t.color}})):[];switch(z.type){case D.fq:case D.Fe:case D.e_:return{y:Number(_.get(e,t.data)),x:ae?i:l,tooltip:r};case D.u3:var n,u=ae?i:l;return n={},(0,a.Z)(n,u,Number(_.get(e,t.data))),(0,a.Z)(n,"key",u),(0,a.Z)(n,"value",Number(_.get(e,t.data))),(0,a.Z)(n,"tooltip",r),n;case D.en:return{value:Number(_.get(e,t.data)),id:ae?i:l,tooltip:r}}}))},je=[],Je=le?q:_.find(h.Z,{value:null==z?void 0:z.colorScheme}).colors,Ke=Je.length;if(oe)Ne=_.cloneDeep(z.rep,[]).map((function(e,t){var o=(0,Z.getDataByPath)(e.path,[]);return o.length>0&&(z.type!==D.fq&&z.type!==D.en||(o=_.uniqBy(o,e.key)),o=Fe(o,e)),z.type===D.en||z.type===D.u3?o:(z.type!==D.en&&je.push({color:Je[t%Ke],label:e.title||e.path}),{id:e.title||e.path,data:o})})),(z.type===D.en||z.type===D.u3)&&(Ne=($=[]).concat.apply($,(0,l.Z)(Ne)),je=null===(ee=Ne)||void 0===ee?void 0:ee.map((function(e,t){return{color:z.type===D.u3?Je[0]:Je[t%Ke],label:e.id||e.key}})));else if(null!=z.datasource_path)try{Ne=(0,Z.getDataByPath)(z.datasource_path,[]),z.type===D.fq&&(Ne=_.uniqBy(Ne,z.key_name));var Qe,Ue={key:z.key_name,data:z.data_name};z.type===D.en||z.type===D.u3?(Ne=Fe(Ne,Ue),je=null===(Qe=Ne)||void 0===Qe?void 0:Qe.map((function(e,t){return{color:z.type===D.u3?Je[0]:Je[t%Ke],label:e.id||e.key}}))):(je.push({color:Je[0],label:z.datasource_title||z.datasource_path}),Ne=[{id:z.datasource_title||z.datasource_path,data:Fe(Ne,Ue)}])}catch(e){console.log("===================================="),console.error(e),console.log("===================================="),Ne=[{id:z.datasource_title||z.datasource_path,data:[]}]}if(le)var $e=_.cloneDeep(z.repcolor,[]).map((function(e){return e.color.colorPickedHex}));if(!te&&0===Ne.length)return i.createElement("div",{className:"altrp-chart ".concat(z.legendPosition)},"Идет загрузка данных...");var et={source:te+function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!e)return"";var t=e.split("\n"),o=t.map((function(e){return e.replace("|","=")})).join("&");return"?".concat(o)}(null===(c=z.query)||void 0===c?void 0:c.defaultParams),options:{colorScheme:z.colorScheme,legend:z.legend,animated:z.animated,isVertical:z.isVertical},filter:{}};switch((0,i.useEffect)((function(){je.length>0&&function(e){T((0,r.Xe)(X,{legend:e}))}(je)}),[je]),console.log("===================================="),console.log(Ne),console.log("===================================="),z.type){case D.fq:return i.createElement(C.Z,{widgetID:B,margin:O,useCustomTooltips:j,yScaleMax:H,customColorSchemeChecker:I,customColors:q,widget:et,dataSource:Ne,keyIsDate:ae,xScaleType:ce,precision:se,curve:ve,colorScheme:ke,enableArea:me,enablePoints:pe,lineWidth:he,pointColor:ye,pointSize:ge,yMarker:be,width:"".concat(null===(s=z.width)||void 0===s?void 0:s.size).concat(null===(v=z.width)||void 0===v?void 0:v.unit),height:"".concat(null===(k=z.height)||void 0===k?void 0:k.size).concat(null===(m=z.height)||void 0===m?void 0:m.unit),yMarkerValue:fe,yMarkerOrientation:xe,yMarkerColor:Me,yMarkerWidth:Ce,yMarkerLabel:Se,xMarker:_e,xMarkerValue:De,xMarkerOrientation:Ze,xMarkerColor:Pe,xMarkerWidth:Le,xMarkerLabel:Re,yMarkerLabelColor:we,xMarkerLabelColor:Ye,constantsAxises:U,sort:ie,tickRotation:re,bottomAxis:ne,enableGridX:ue,enableGridY:de});case D.e_:return i.createElement(w.Z,{widgetID:B,margin:O,useCustomTooltips:j,yScaleMax:H,customColorSchemeChecker:I,customColors:q,dataSource:Ne,constantsAxises:U,colorScheme:ke,width:"".concat(null===(p=z.width)||void 0===p?void 0:p.size).concat(null===(g=z.width)||void 0===g?void 0:g.unit),height:"".concat(null===(y=z.height)||void 0===y?void 0:y.size).concat(null===(b=z.height)||void 0===b?void 0:b.unit),widget:et,nodeSize:ge,xScaleType:ce,precision:se,sort:ie,tickRotation:re,bottomAxis:ne,enableGridX:ue,enableGridY:de});case D.u3:return i.createElement(x,{widgetID:B,margin:O,useCustomTooltips:j,yScaleMax:H,customColorSchemeChecker:I,customColors:q,isMultiple:oe,colorScheme:ke,dataSource:Ne,widget:et,enableLabel:ze,width:"".concat(null===(f=z.width)||void 0===f?void 0:f.size).concat(null===(L=z.width)||void 0===L?void 0:L.unit),height:"".concat(null===(R=z.height)||void 0===R?void 0:R.size).concat(null===(Y=z.height)||void 0===Y?void 0:Y.unit),layout:Ee,groupMode:Ge,reverse:Ae,borderRadius:Ve,borderWidth:We,padding:Be,sort:ie,tickRotation:re,bottomAxis:ne,enableGridX:ue,enableGridY:de});case D.en:return i.createElement(M.Z,{widgetID:B,margin:O,useCustomTooltips:j,yScaleMax:H,customColorSchemeChecker:I,customColors:q,isMultiple:oe,dataSource:Ne,colorScheme:ke,widget:et,width:"".concat(null===(E=z.width)||void 0===E?void 0:E.size).concat(null===(G=z.width)||void 0===G?void 0:G.unit),height:"".concat(null===(A=z.height)||void 0===A?void 0:A.size).concat(null===(V=z.height)||void 0===V?void 0:V.unit),innerRadius:Te,enableSliceLabels:Oe,padAngle:Xe,cornerRadius:Ie,sortByValue:qe,enableRadialLabels:He,sort:ie,tickRotation:re,bottomAxis:ne,enableGridX:ue,enableGridY:de});case D.Fe:return i.createElement(S.Z,{widgetID:B,useCustomTooltips:j,isCustomColor:le,colorArray:$e,isMultiple:oe,dataSource:Ne,widget:et,width:null===(W=z.width)||void 0===W?void 0:W.size,sort:ie,tickRotation:re,bottomAxis:ne,enableGridX:ue,enableGridY:de});default:return i.createElement(i.Fragment,null)}}))}}]);
//# sourceMappingURL=AltrpDiagram.196ce11709059447eea6.bundle.js.map