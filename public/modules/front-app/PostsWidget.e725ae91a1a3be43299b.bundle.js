(self.webpackChunk=self.webpackChunk||[]).push([[1197,1198],{71743:function(e,t,r){"use strict";var a=r(6610),n=r(5991),o=r(83465),s=r.n(o),i=r(29208),u=r.n(i),c=r(31468),l=r.n(c),d=r(38394),h=r.n(d),p=r(96633),f=r.n(p),g=r(99245),y=r.n(g),m=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,a.Z)(this,e),this.data=s()(t)}return(0,n.Z)(e,[{key:"getData",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return e?s()(this.data):this.data}},{key:"isEmpty",value:function(){return y()(this.data)}},{key:"getProperty",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return u()(this.data,e,t)}},{key:"hasProperty",value:function(e){return h()(this.data,e)}},{key:"setProperty",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return r instanceof e&&(r=r.getData(!1)),l()(this.data,t,r)}},{key:"unsetProperty",value:function(e){return f()(this.data,e)}}]),e}();window.AltrpModel=m,t.Z=m},71614:function(e,t,r){"use strict";var a=r(92137),n=r(96156),o=r(85061),s=r(6610),i=r(5991),u=r(87757),c=r.n(u),l=r(38773),d=r(75098),h=r(76593);function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var g=function(){function e(t,r){(0,s.Z)(this,e),this.component=r,this.modelName=t.modelName||"",this.dataSource=t.dataSource,t.dataSource&&"model_query"===t.dataSource.type&&(this.dataSourceName=t.dataSource.value||""),this.pageSize=t.pageSize||10,this.paginationType=t.paginationType||"pages",this.orderingField=t.orderingField||"name",this.order=t.order||"ASC",this.route="/ajax/models/".concat(this.modelName||(t.dataSource?t.dataSource.value:"")),t.dataSource&&"sql_datasource"===t.dataSource.type&&(this.route=t.dataSource.value,this.dataSourceName=t.dataSource.sql_name||"");var a=_.cloneDeep(r.props.currentModel);a.setProperty("altrpdata",r.props.currentDataStorage.getData()),this.setDefaultParams((0,h.parseParamsFromString)(t.defaultParams,a))}var t;return(0,i.Z)(e,[{key:"getResource",value:function(){return new l.Z({route:this.route})}},{key:"getFromModel",value:function(e){return e?_.isArray(e[this.dataSource.value])?(0,o.Z)(e[this.dataSource.value]):[f({},e[this.dataSource.value])]:[]}},{key:"getQueried",value:(t=(0,a.Z)(c().mark((function e(t){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.dataSource||"has_many_relation"!==this.dataSource.type){e.next=4;break}this.modelUpdater?console.log(this.modelUpdater):this.modelUpdater=d.default.subscribeToModelUpdates(this.dataSource.model_name,this.component.getModelId(),this.component),e.next=10;break;case 4:return e.next=6,this.getResource().getQueried(this.getParams(t));case 6:return this.lastQuery=e.sent,_.isArray(this.lastQuery)?r=(0,o.Z)(this.lastQuery):_.isArray(this.lastQuery.data)&&(r=this.lastQuery.data),r.hasMore=this.lastQuery.hasMore,e.abrupt("return",r);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"hasMore",value:function(){return!!this.lastQuery&&this.lastQuery.hasMore}},{key:"setDefaultParams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.defaultParams=e}},{key:"getDefaultParams",value:function(){return this.defaultParams=this.defaultParams||{},this.defaultParams.pageSize=this.pageSize,this.defaultParams}},{key:"getParams",value:function(e){return(e=f({},_.assign(_.cloneDeep(this.getDefaultParams()),e))).page=e.page||1,_.has(e,"pageSize")&&e.pageSize<=0&&(delete e.pageSize,delete e.page),e}},{key:"getCounterStart",value:function(e){var t=1;return this.pageSize<1?t:(e=parseInt(e)||1,t=this.pageSize*(e-1)+1)}}]),e}();t.Z=g},75098:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var a=r(6610),n=r(5991),o=r(96156),s=r(92137),i=r(87757),u=r.n(i),c=r(38773);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}var d=function(){function e(t,r){(0,a.Z)(this,e),this.modelName=t,r||console.error("ид модели не указан!"),this.modelId=r,this.data=null,this.subscribers=[],this.resource=new c.Z({route:"/ajax/models/".concat(this.modelName)}),this.updating=!1}var t;return(0,n.Z)(e,[{key:"subscribeToUpdates",value:function(e){this.subscribers.push(e),this.updating||(this.data&&this.callSubscribers(),this.updateData())}},{key:"updateData",value:(t=(0,s.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updating=!0,e.next=3,this.resource.get(this.modelId);case 3:this.data=e.sent,this.updating=!1,this.callSubscribers();case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"callSubscribers",value:function(){var e=this;this.subscribers.forEach((function(t){_.isFunction(t.updateModelData)&&t.updateModelData(e.getData()),_.isFunction(t)&&t(e.getData())}))}},{key:"unsubscribe",value:function(e){this.subscribers=this.subscribers.filter((function(t){return t!==e}))}},{key:"getData",value:function(){return this.data}},{key:"updateWithData",value:function(e){this.data=_.extend(this.data,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,o.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e)),this.callSubscribers()}}]),e}(),h=new(function(){function e(){(0,a.Z)(this,e),this.modelsStorage={}}return(0,n.Z)(e,[{key:"updateModel",value:function(e,t){this.modelsStorage["".concat(e,"::").concat(t)]||this.modelsStorage["".concat(e,"::").concat(t)].updateData()}},{key:"addModel",value:function(e){}},{key:"getModel",value:function(e,t){}},{key:"subscribeToModelUpdates",value:function(e,t,r){return t?(this.modelsStorage["".concat(e,"::").concat(t)]||(this.modelsStorage["".concat(e,"::").concat(t)]=new d(e,t)),(a=this.modelsStorage["".concat(e,"::").concat(t)]).subscribeToUpdates(r),a):null;var a}},{key:"unsubscribe",value:function(e,t,r){return t?this.modelsStorage["".concat(e,"::").concat(t)]?((a=this.modelsStorage["".concat(e,"::").concat(t)]).unsubscribe(r),a):void 0:null;var a}},{key:"updateModelWithData",value:function(e,t,r){this.modelsStorage["".concat(e,"::").concat(t)]&&this.modelsStorage["".concat(e,"::").concat(t)].updateWithData(r)}}]),e}())},33765:function(e,t,r){"use strict";r.r(t);var a=r(96156),n=r(6610),o=r(5991),s=r(63349),i=r(10379),u=r(46070),c=r(77608),l=r(71614),d=r(76593);function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach((function(t){(0,a.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var f=function(e){(0,i.Z)(f,e);var t,a,h=(t=f,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,c.Z)(t);if(a){var n=(0,c.Z)(this).constructor;e=Reflect.construct(r,arguments,n)}else e=r.apply(this,arguments);return(0,u.Z)(this,e)});function f(e){var t;return(0,n.Z)(this,f),(t=h.call(this,e)).state={settings:e.element.getSettings(),PostsComponent:function(){return React.createElement("div",{children:"Loading..."})}},e.element.component=(0,s.Z)(t),window.elementDecorator&&window.elementDecorator((0,s.Z)(t)),e.baseRender&&(t.render=e.baseRender((0,s.Z)(t))),t}return(0,o.Z)(f,[{key:"_componentDidMount",value:function(){var e=this;Promise.all([r.e(1902),r.e(5977),r.e(1298),r.e(9981),r.e(2360),r.e(268),r.e(7576),r.e(4766),r.e(9741)]).then(r.bind(r,99822)).then((function(t){e.setState((function(e){return p(p({},e),{},{PostsComponent:t.default})}))}))}},{key:"showPosts",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"datasource"===this.props.element.getSettings("choose_datasource")||!(!e.modelName&&!e.dataSource)}},{key:"render",value:function(){if(!this.props.currentModel.getProperty("altrpModelUpdated"))return"";var e=new l.Z(this.props.element.getSettings().table_query||{},this);if(!this.showPosts(e))return React.createElement("div",{children:"Please Choose Source"});var t=e.getFromModel(this.state.modelData)||[];if("datasource"===this.props.element.getSettings("choose_datasource")){var r=this.props.element.getSettings("posts_datasource","");r=r.replace(/}}/g,"").replace(/{{/g,""),t=(0,d.getDataByPath)(r,[],this.props.element.getCurrentModel().getData())}return React.createElement(this.state.PostsComponent,{query:e,currentModel:this.props.currentModel,data:t,element:this.props.element,settings:this.props.element.getSettings()})}}]),f}(Component);t.default=f}}]);
//# sourceMappingURL=PostsWidget.e725ae91a1a3be43299b.bundle.js.map