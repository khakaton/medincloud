{"version":3,"sources":["webpack:///./resources/modules/admin/src/components/AdvancedSettings.js"],"names":["MediaInput","React","AdvancedSettings","props","toggleDebug","e","value","target","checked","Resource","route","put","setState","state","debugOn","toggleLoadingOption","loadByUser","deleteAllTemplatesReviews","confirm","store","setAdminDisable","delete","success","alert","setAdminEnable","clearAllCache","updateAllBackendResources","post","updateAllSiteJavascript","allSiteJavascript","encrypt","get","all_site_js","altrp_debug","altrp_user_load","this","JSON","stringify","dispatch","setAdminLogo","className","width","htmlFor","Suspense","fallback","onChange","changeAdminLogo","adminLogo","onClick","mode","type","Component","connect"],"mappings":"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","file":"493.admin.js","sourcesContent":["import React, {Component, Suspense} from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport {setAdminLogo} from \"../js/store/admin-logo/actions\";\r\nimport Resource from \"../../../editor/src/js/classes/Resource\";\r\nimport {setAdminDisable, setAdminEnable} from \"../js/store/admin-state/actions\";\r\nimport AltrpCodeEditor from \"./altrp-editor/AltrpCodeEditor\";\r\nimport store from '../js/store/store';\r\n\r\nconst MediaInput = React.lazy(() => import('./media-input/MediaInput.js'));\r\n\r\nclass AdvancedSettings extends Component {\r\n  constructor(props){\r\n    super(props);\r\n    this.state = {\r\n      allSiteJavascript: '',\r\n      debugOn: false,\r\n    }\r\n  }\r\n\r\n  /**\r\n   *\r\n   */\r\n  async componentDidMount() {\r\n    const allSiteJavascript = (await new Resource({route: '/admin/ajax/settings'}).get('all_site_js?decrypt=true')).all_site_js || '';\r\n    // let debugOn = ! ! (await new Resource({route:'/admin/ajax/settings'}).get('altrp_debug').altrp_debug);\r\n    let debugOn = ! ! (await new Resource({route:'/admin/ajax/settings'}).get('altrp_debug')).altrp_debug;\r\n    let loadByUser = ! ! (await new Resource({route:'/admin/ajax/settings'}).get('altrp_user_load')).altrp_user_load;\r\n    this.setState(state => ({...state,\r\n      allSiteJavascript,\r\n      debugOn,\r\n      loadByUser,\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Изменить лого\r\n   * @param value\r\n   * @return {Promise<void>}\r\n   */\r\n\r\n  async changeAdminLogo(value){\r\n    await new Resource({route:'/admin/ajax/settings'}).put('admin_logo', {value: JSON.stringify(value)});\r\n    this.dispatch(setAdminLogo(value));\r\n  }\r\n  /**\r\n   * Включить дебаг на фронте\r\n   * @param e\r\n   * @return {Promise<void>}\r\n   */\r\n\r\n  toggleDebug = async (e)=>{\r\n    // await new Resource({route:'/admin/ajax/settings'}).put('admin_logo', {value: JSON.stringify(value)});\r\n    // this.dispatch(setAdminLogo(value));\r\n    let value = e.target.checked;\r\n    await new Resource({route:'/admin/ajax/settings'}).put('altrp_debug', {value});\r\n    this.setState(state=>({\r\n      ...state,\r\n      debugOn: value,\r\n    }))\r\n  };\r\n  /**\r\n   * Включить дебаг на фронте\r\n   * @param e\r\n   * @return {Promise<void>}\r\n   */\r\n\r\n  toggleLoadingOption = async (e)=>{\r\n    // await new Resource({route:'/admin/ajax/settings'}).put('admin_logo', {value: JSON.stringify(value)});\r\n    // this.dispatch(setAdminLogo(value));\r\n    let value = e.target.checked;\r\n    await new Resource({route:'/admin/ajax/settings'}).put('altrp_user_load', {value});\r\n    this.setState(state=>({\r\n      ...state,\r\n      loadByUser: value,\r\n    }))\r\n  };\r\n\r\n  /**\r\n   * Удалить всю историю всех шаблонов\r\n   * @param e\r\n   */\r\n  deleteAllTemplatesReviews = async (e) =>{\r\n    let result  = await confirm('Are You Sure');\r\n    if(! result){\r\n      return;\r\n    }\r\n    store.dispatch(setAdminDisable());\r\n    let res = await new Resource({route:'/admin/ajax/reviews'}).delete();\r\n    if(res.success){\r\n      await alert('success');\r\n    }\r\n    store.dispatch(setAdminEnable());\r\n  };\r\n\r\n  /**\r\n   * Запрос на очистку кэша\r\n   */\r\n  clearAllCache = async (e) =>{\r\n    let result  = await confirm('Are You Sure');\r\n    if(! result){\r\n      return;\r\n    }\r\n    let res = await new Resource({route:'/admin/ajax/clear_cache'}).delete();\r\n\r\n  };\r\n  /**\r\n   * Обновить всех ресурсы на бкенде (модели, шаблоны, контроллеры и т.д.)\r\n   * @param e\r\n   */\r\n  updateAllBackendResources = async (e) =>{\r\n    let result  = await confirm('Are You Sure');\r\n    if(! result){\r\n      return;\r\n    }\r\n    store.dispatch(setAdminDisable());\r\n\r\n    let res = await new Resource({route:'/admin/ajax/update-all-resources'}).post({});\r\n    if(res.success){\r\n      await alert('success');\r\n    }\r\n    store.dispatch(setAdminEnable());\r\n  };\r\n  render() {\r\n    return <div className=\"admin-styles-settings\">\r\n      <table>\r\n        <tbody className=\"admin-settings-table-row\">\r\n        <tr className=\"admin-settings-table-row\">\r\n          <td className=\"admin-settings-table__td row-text\" width=\"10%\">\r\n            <label htmlFor=\"settings-container-width\">\r\n              Admin Logo:\r\n            </label>\r\n          </td>\r\n          <td className=\"admin-settings-table__td\">\r\n            <Suspense fallback={'Loading'}>\r\n              <MediaInput onChange={this.changeAdminLogo} value={this.props.adminLogo}/>\r\n            </Suspense>\r\n          </td>\r\n        </tr>\r\n        <tr className=\"admin-settings-table-row\">\r\n          <td className=\"admin-settings-table__td row-text\" width=\"10%\">\r\n            Clear All Templates History\r\n          </td>\r\n          <td className=\"admin-settings-table__td\">\r\n            <button className=\"btn btn_success\"\r\n                    onClick={this.deleteAllTemplatesReviews}>\r\n              Clear\r\n            </button>\r\n          </td>\r\n        </tr>\r\n        <tr className=\"admin-settings-table-row\">\r\n          <td className=\"admin-settings-table__td row-text\" width=\"10%\">\r\n            Update All Backend Resources\r\n          </td>\r\n          <td className=\"admin-settings-table__td\">\r\n            <button className=\"btn btn_success\"\r\n                    onClick={this.updateAllBackendResources}>\r\n              Update\r\n            </button>\r\n          </td>\r\n        </tr>\r\n        <tr className=\"admin-settings-table-row\">\r\n          <td className=\"admin-settings-table__td row-text\" width=\"10%\">\r\n            Clear All Cache\r\n          </td>\r\n          <td className=\"admin-settings-table__td\">\r\n            <button className=\"btn btn_success\"\r\n                    onClick={this.clearAllCache}>\r\n              Clear\r\n            </button>\r\n          </td>\r\n        </tr>\r\n        <tr className=\"admin-settings-table-row\">\r\n          <td className=\"admin-settings-table__td row-text\" width=\"10%\">\r\n            Add Custom Javascript on All Site Pages\r\n          </td>\r\n          <td className=\"admin-settings-table__td\">\r\n            <AltrpCodeEditor value={this.state.allSiteJavascript}\r\n                             mode=\"javascript\"\r\n                             onChange={value => this.setState({ allSiteJavascript: value})}\r\n            />\r\n            <button className=\"btn btn_success\"\r\n                    onClick={this.updateAllSiteJavascript}>\r\n              Update\r\n            </button>\r\n          </td>\r\n        </tr>\r\n        <tr className=\"admin-settings-table-row\">\r\n          <td className=\"admin-settings-table__td row-text\" width=\"10%\">\r\n            Debug Altrp App\r\n          </td>\r\n          <td className=\"admin-settings-table__td\">\r\n            <input className=\"admin-table__td_check\"\r\n                   onChange={this.toggleDebug}\r\n                   // value={this.state.debugOn}\r\n                   checked={this.state.debugOn}\r\n                   type=\"checkbox\"/>\r\n          </td>\r\n        </tr>\r\n        <tr className=\"admin-settings-table-row\">\r\n          <td className=\"admin-settings-table__td row-text\" width=\"10%\">\r\n            Load App on User Action\r\n          </td>\r\n          <td className=\"admin-settings-table__td\">\r\n            <input className=\"admin-table__td_check\"\r\n                   onChange={this.toggleLoadingOption}\r\n                   // value={this.state.debugOn}\r\n                   checked={this.state.loadByUser}\r\n                   type=\"checkbox\"/>\r\n          </td>\r\n        </tr>\r\n        {/*<tr className=\"admin-settings-table-row\">*/}\r\n          {/*<td className=\"admin-settings-table__td row-text\" width=\"10%\">*/}\r\n            {/*Clear All Templates History*/}\r\n          {/*</td>*/}\r\n          {/*<td className=\"admin-settings-table__td\">*/}\r\n            {/*<button className=\"btn btn_success\"*/}\r\n                    {/*onClick={this.deleteAllTemplatesReviews}>*/}\r\n              {/*Clear*/}\r\n            {/*</button>*/}\r\n          {/*</td>*/}\r\n        {/*</tr>*/}\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  }\r\n\r\n  /**\r\n   * Сохранить код JS для всего сайта\r\n   */\r\n   updateAllSiteJavascript = async() => {\r\n    await new Resource({route:'/admin/ajax/settings'}).put('all_site_js', {value: this.state.allSiteJavascript, encrypt: true});\r\n  };\r\n}\r\n\r\nfunction mapStateToProps(state) {\r\n  return {\r\n    adminLogo: state.adminLogo,\r\n  };\r\n}\r\n\r\nexport default connect(mapStateToProps)(AdvancedSettings);\r\n"],"sourceRoot":""}